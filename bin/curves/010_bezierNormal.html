<!DOCTYPE html>
<html>
<head>
    <title>007 QuadraticBezier class | v0.1</title>

    <link rel="stylesheet" href="curves.css">

    <script type="text/javascript" src="../../src/requestAnimFrame.js"></script>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../src/requestAnimFrame.js"></script>
<script type="text/javascript" src="../../src/SQR.js"></script>
<script type="text/javascript" src="../../src/sqr/Squareroot.js"></script>
<script type="text/javascript" src="../../src/sqr/SquarerootGL.js"></script>
<script type="text/javascript" src="../../src/sqr/Transform.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Geometry.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/GLRect.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Plane.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Quad.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Triangle.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Interpolation.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Mathx.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix2D.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix33.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix44.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Noise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/PerlinNoise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../../src/sqr/math/QuadraticBezier.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Quaternion.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spline.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spring.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector2.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector3.js"></script>
<script type="text/javascript" src="../../src/sqr/math/VectorUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/CSSCollider.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/Particle.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement2D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement3D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/GL.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Point.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Polygon.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Segment.js"></script>
<script type="text/javascript" src="../../src/sqr/util/CanvasUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Color.js"></script>
<script type="text/javascript" src="../../src/sqr/util/DOMUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/GLState.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Interactor.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Loader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Shader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Stringify.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Time.js"></script>
<!-- SQRLIB -->

    <script type="text/javascript">

        var ctx, c, phase = 0;
        var p = new SQR.V2();
        var v = new SQR.V2();
        var vn = new SQR.V2();

        window.onload = function() {
            ctx = document.getElementById('cnv').getContext('2d');

            c = new SQR.QuadraticBezier(
                    new SQR.V2(100, 350),
                    new SQR.V2(600, 50),
                    new SQR.V2(500, 450),
                    new SQR.V2(900, 250)
            );

            render();
        }


        function render() {
            requestAnimFrame(render);

            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.clearRect(0, 0, 1000, 500);

            // 1 ############################################
            ctx.globalAlpha = 0.2;
            ctx.strokeStyle = 'rgb(255,0,0)';

            ctx.beginPath();

            ctx.moveTo(c.p0.x, c.p0.y);
            ctx.lineTo(c.c0.x, c.c0.y);
            ctx.lineTo(c.c1.x, c.c1.y);
            ctx.lineTo(c.p1.x, c.p1.y);

            ctx.stroke();

            // 2 ############################################
            ctx.globalAlpha = 0.2;
            ctx.strokeStyle = 'rgb(0,0,128)';

            ctx.beginPath();

            for (var i = 0; i <= 100; i += 1) {
                var t = i / 100;
                var p = c.valueAt(t);
                if (i == 0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            }

            ctx.stroke();

            // 3 ############################################

            ctx.strokeStyle = 'rgb(0,0,128)';

            for (var i = 0; i <= 50; i += 1) {
                var t = i / 50;

                p = c.valueAt(t, p);
                v = c.velocityAt(t, v);

                v.mul(0.02).perpendicular();
                vn.copyFrom(v).neg();

                v.add(v, p);
                vn.add(vn, p);

                ctx.beginPath();
                ctx.moveTo(vn.x, vn.y);
                ctx.lineTo(v.x, v.y);
                ctx.stroke();
            }

            // 4 ############################################
            var dir = Math.sin(phase);
            var ph = (dir + 1) * 0.5;
            p = c.valueAt(ph, p);
            v = c.velocityAt(ph, v).norm();

            var orientation = Math.atan2(v.y, v.x);

            ctx.globalAlpha = 1;
            ctx.fillStyle = 'rgb(0,128,0)';

            ctx.translate(p.x, p.y);
            ctx.rotate(orientation);

            ctx.beginPath();
            ctx.moveTo(-10, 10);
            ctx.lineTo(10, 10);
            ctx.lineTo(20, 0);
            ctx.lineTo(10, -10);
            ctx.lineTo(-10, -10);
            ctx.fill();

            phase += 0.01;
        }

    </script>

</head>
<body>

<div id="desc">
    <h1>010 Bezier velocity and path orienation</h1>

    <p>An exmaple visualizing the velocity and normal vectors on a Bezier curve and using it to orient an object to the
        path</p>
</div>


<div id="container">
    <canvas id="cnv" width="1000" height="500"></canvas>
</div>
</body>
</html>