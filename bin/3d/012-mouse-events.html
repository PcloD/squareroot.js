<!DOCTYPE html>
<html>
<head>
    <title>MouseEvents in 3D | v0.15</title>


    <script type="text/javascript" src="../../lib/modernizr.custom.56278.js"></script>

<!-- SQRLIB -->
<!-- Auto-generated by tools/demojstags.py. Do not edit this section -->
<script type="text/javascript" src="../../src/requestAnimFrame.js"></script>
<script type="text/javascript" src="../../src/SQR.js"></script>
<script type="text/javascript" src="../../src/sqr/Squareroot.js"></script>
<script type="text/javascript" src="../../src/sqr/SquarerootGL.js"></script>
<script type="text/javascript" src="../../src/sqr/Transform.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Geometry.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/GLRect.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Plane.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Quad.js"></script>
<script type="text/javascript" src="../../src/sqr/geometry/Triangle.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Interpolation.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Mathx.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix2D.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix33.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Matrix44.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Noise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/PerlinNoise.js"></script>
<script type="text/javascript" src="../../src/sqr/math/ProjectionMatrix.js"></script>
<script type="text/javascript" src="../../src/sqr/math/QuadraticBezier.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Quaternion.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spline.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Spring.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector2.js"></script>
<script type="text/javascript" src="../../src/sqr/math/Vector3.js"></script>
<script type="text/javascript" src="../../src/sqr/math/VectorUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/CSSCollider.js"></script>
<script type="text/javascript" src="../../src/sqr/physics/Particle.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement2D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/DOMElement3D.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/GL.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Point.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Polygon.js"></script>
<script type="text/javascript" src="../../src/sqr/renderers/Segment.js"></script>
<script type="text/javascript" src="../../src/sqr/util/CanvasUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Color.js"></script>
<script type="text/javascript" src="../../src/sqr/util/DOMUtil.js"></script>
<script type="text/javascript" src="../../src/sqr/util/GLState.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Interactor.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Loader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Shader.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Stringify.js"></script>
<script type="text/javascript" src="../../src/sqr/util/Time.js"></script>
<!-- SQRLIB -->

    <style type="text/css">

        body {
            overflow: hidden;
            background-color: #000000;
        }

        #canvas {
            position: absolute;
            top: 0px;
            left: 0px;
        }

        #container {
            position: absolute;
            top: 50%;
            left: 50%;
        }

        .plane {
            position: absolute;
            margin-top: -200px;
            margin-left: -200px;
            width: 400px;
            height: 400px;
            overflow: hidden;
            background: red;
        }

        .plane img {
            position: absolute;
            width: 400px;
            height: 400px;
        }

        #instr {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: Georgia, sans-serif;
            color: #ffffff;
            font-size: 14px;
        }

    </style>

    <script type="text/javascript">

        var container, canvas;
        var engine, camera;
        var root;
        var interactor;

        var photos = [];

        function createDiv(imageUrl) {
            var ht = document.createElement('div');
            ht.setAttribute('class', 'plane');

            var hti = new Image();
            hti.src = imageUrl;
            ht.appendChild(hti);

            return ht
        }


        function createPhoto(name, x, y, z, ry, h, src) {
            var p = new SQR.Transform(name);
            p.renderer = new SQR.DOMElement3D(createDiv(src));
            p.renderer.setBackfaceVisibility(true);
            p.collider = new SQR.CSSCollider(400, 400);
            p.position.set(x, y, z);
            photos.push(p);

            root.add(p);
        }

        window.onload = function() {
            SQR.supportsCss3d = Modernizr.csstransforms3d;

            interactor = new SQR.Interactor();

            container = document.getElementById("container");
            canvas = document.getElementById("canvas");

            // Parameters are: canvas, container
            engine = new SQR.Squareroot(canvas, container);
            engine.setSize(window.innerWidth, window.innerHeight);
            engine.setProjection(30);

            camera = new SQR.Transform();
            camera.position.z = engine.cssDistance();
            engine.add(camera);

            root = new SQR.Transform();

            createPhoto("sq", 0, 0, 0,   0, 50, "../assets/square-400.jpg");
            createPhoto("ft", 0, 0, 100, 0, 60, "../assets/fruits-400.jpg");
            createPhoto("ft", 0, 0, 200, 0, 70, "../assets/square-400.jpg");
            createPhoto("ft", 0, 0, 300, 0, 80, "../assets/fruits-400.jpg");
            createPhoto("ft", 0, 0, 400, 0, 90, "../assets/square-400.jpg");

            engine.add(root);

            render();
        }

        var a = SQR.twoPI * Math.random();
        var hits = [];

        function render() {
            requestAnimFrame(render);

            root.rotation.y = a;
            root.position.x = Math.sin(a) * 200;

//            a += 0.04;
            a += 0.01;

            hits.length = 0;

            for(var i = 0; i < photos.length; i++) {
                var p = photos[i];

                // Disable all before eventually enabling the hovered one
                p.renderer.element.style.opacity = 0.2;

                // This needs to be in local coordinates of the canvas and/or container
                if(p.collider.intersects(interactor.pageX, interactor.pageY)) {
                    hits.push(p);
                }
            }

            hits.sort(function(a, b) {
                var ad = a.depth();
                var bd = b.depth();
                if (ad < bd) return 1;
                if (ad > bd) return -1;
                return 0;
            });

            if(hits.length > 0) hits[0].renderer.element.style.opacity = 1;

            engine.render(camera);
        }

    </script>

</head>
<body>

<canvas id="canvas"></canvas>
<div id="container"></div>



<div id="instr">Alternate way to detect mouse/touch events on 3d divs (regular events are buggy in some browsers)</div>

</body>
</html>