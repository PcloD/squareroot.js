SQR.Primitives.createPoint=function(e,a){return SQR.Buffer().layout(SQR.v2(),1).setMode(SQR.gl.POINTS).data("aPosition",e||0,a||0).update()},SQR.Primitives.createCube=function(e,a,r,t){e=e||1,a=a||1,r=r||1;var n=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},36),o=new SQR.V3(e*-.5,.5*a,.5*r),s=new SQR.V3(.5*e,.5*a,.5*r),u=new SQR.V3(e*-.5,a*-.5,.5*r),i=new SQR.V3(.5*e,a*-.5,.5*r),c=new SQR.V3(e*-.5,.5*a,r*-.5),f=new SQR.V3(.5*e,.5*a,r*-.5),l=new SQR.V3(e*-.5,a*-.5,r*-.5),S=new SQR.V3(.5*e,a*-.5,r*-.5),v=new SQR.V2(0,1),Q=new SQR.V2(1,1),m=new SQR.V2(0,0),R=new SQR.V2(1,0),h=[];h.push(SQR.Face().setPosition(o,s,u,i).setUV(v,Q,m,R)),h.push(SQR.Face().setPosition(f,c,S,l).setUV(v,Q,m,R)),h.push(SQR.Face().setPosition(c,o,l,u).setUV(v,Q,m,R)),h.push(SQR.Face().setPosition(s,f,i,S).setUV(v,Q,m,R)),h.push(SQR.Face().setPosition(c,f,o,s).setUV(v,Q,m,R)),h.push(SQR.Face().setPosition(u,i,l,S).setUV(v,Q,m,R));var d=0;return h.forEach(function(e){t&&t.reverseNormals&&e.flip(),e.calculateNormal(),d+=e.toBuffer(n,d)}),n},SQR.Primitives.createSkybox=function(e,a,r){if(!a&&SQR.GLSL&&(a=SQR.GLSL["shaders/skybox.glsl"]),!a)throw"Missing shader code. Pass GLSL string as 2nd argument or include sqr-glsl to use the default one.";var t=new SQR.Transform;return r=r||5,t.shader=SQR.Shader(a),t.buffer=SQR.Primitives.createCube(r,r,r,{reverseNormals:!0}).update(),t.addCubemap=function(e){e&&(t.cubemap=SQR.Cubemap(e),t.shader.use().setUniform("uCubemap",t.cubemap))},t.addCubemap(e),t.useDepth=!1,t},SQR.Primitives.createCylinder=function(e,a,r,t){t=t||{};var n,o,s,u,i,c,f=[],l=function(e,a,r,t,n,o,s,u){var i=(new SQR.Face).setPosition(e,a,r,t).setUV(n,o,s,u);f.push(i)};n=[],o=[],s=[],u=[];for(var S=0;r>S;S++){var v=new SQR.V3,Q=new SQR.V3,m=new SQR.V2,R=new SQR.V2,h=Math.cos(S/r*SQR.TWOPI)*a,d=Math.sin(S/r*SQR.TWOPI)*a;t.vertical?(v.set(d,e*-.5,h),Q.set(d,.5*e,h)):(v.set(e*-.5,h,d),Q.set(.5*e,h,d)),m.set(S/r,0),R.set(S/r,1),t.noCaps||(t.vertical?(i=new SQR.V3(0,e*-.5,0),c=new SQR.V3(0,.5*e,0)):(i=new SQR.V3(e*-.5,0,0),c=new SQR.V3(.5*e,0,0))),n.push(v),o.push(Q),s.push(m),u.push(R),t.insideFaces&&(v._inside=v.clone(),Q._inside=Q.clone())}for(var S=0;r>S;S++){var V=n[S],w=o[S],P=s[S],p=u[S],b=(S+1)%r,g=n[b],N=o[b],U=s[b],_=u[b];l(V,w,g,N,P,p,U,_),t.noCaps?t.insideFaces&&l(V._inside,g._inside,w._inside,N._inside,P,p,U,_):(l(V,g,i,null,p,_,U),l(N,w,c,null,_,p,U))}var v,M=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*f.length),F=0;return f.forEach(function(e){F+=e.calculateNormal().toBuffer(M,F)}),M},SQR.Extrude=function(){var e={};e.buffer=SQR.Buffer();var a,r,t,n,o,s,u,i=[],c=[];e.setPaths=function(o,s,u,i){return a=o,r=o.length,t=s,n=u||10,f(i),e},e.makeCaps=function(){return e};var f=function(a){i.length=0,c.length=0,a=a||SQR.v3n3();for(var t=0;n>t;t++)for(var o=0;r>o;o++){var s=new SQR.V3;i.push(s)}for(var t=0;n-1>t;t++)for(var o=0;r>o;o++){var u=t*r+o,f=r-1>o?u+1:t*r,l=(t+1)*r+o,S=r-1>o?l+1:(t+1)*r,v=(new SQR.Face).setPosition(i[u],i[S],i[f]),Q=(new SQR.Face).setPosition(i[u],i[l],i[S]);c.push(v,Q)}e.buffer.layout(a,3*c.length)},l=function(u){for(var f=0;n>f;f++)for(var l=f/(n-1),S=s+l*o,v=t.matrixAt(S),Q=0;r>Q;Q++){var m=i[f*r+Q];m.copyFrom(a[Q]),u&&u(l,m),v.transformVector(m)}for(var R=0,f=0,h=c.length;h>f;f++)R+=c[f].calculateNormal().toBuffer(e.buffer,R,!1,!0)};return e.update=function(a,r,t){return s=a||0,u=r||1,o=u-s,l(t),e.buffer.update(),e},e},SQR.Face=function(){var e={},a="aPosition",r="aNormal",t="aUV";return e.setPosition=function(a,r,t,n){return e.a=a,e.b=r,e.c=t,e.d=n,e},e.flip=function(){var a=e.b;e.b=e.c,e.c=a},e.setNormal=function(a){return e.normal=a,e},e.setUV=function(a,r,t,n){return e.uva=a,e.uvb=r,e.uvc=t,e.uvd=n,e},e.setColor=function(a,r,t,n){return e.ca=a,e.cb=r,e.cc=t,e.cd=n,e},e.calculateNormal=function(){var a=SQR.V3.__tv1,r=SQR.V3.__tv2;return e.normal=new SQR.V3,a.sub(e.a,e.b),a.isZero()&&a.sub(e.a,e.d),r.sub(e.c,e.a),e.normal.cross(a,r),e},e.addNormalToVertices=function(){return e.a.addNormal(e.normal),e.b.addNormal(e.normal),e.c.addNormal(e.normal),e.d&&e.d.addNormal(e.normal),e},e.toBuffer=function(n,o,s,u){var i=o;if(n.attributes[a]&&(n.set(a,i+0,e.a).set(a,i+1,e.b).set(a,i+2,e.c),e.d&&n.set(a,i+3,e.c).set(a,i+4,e.b).set(a,i+5,e.d)),n.attributes[r]&&(e.normal||s)){var c=s,f=e.normal;u&&!c&&e.normal.norm(),n.set(r,i+0,c?e.a.normal:f).set(r,i+1,c?e.b.normal:f).set(r,i+2,c?e.c.normal:f),e.d&&n.set(r,i+3,c?e.c.normal:f).set(r,i+4,c?e.b.normal:f).set(r,i+5,c?e.d.normal:f)}return n.attributes[t]&&e.uva&&(n.set(t,i+0,e.uva).set(t,i+1,e.uvb).set(t,i+2,e.uvc),e.d&&n.set(t,i+3,e.uvc).set(t,i+4,e.uvb).set(t,i+5,e.uvd)),e.d?6:3},e},SQR.Primitives.createIcosphere=function(e,a,r){var t=[],n=[],o=[],s=0;r=r||{};var u=[[1,0,0,1],[0,1,0,2],[0,0,1,3],[1,1,0,4],[0,1,1,5]],i=new SQR.V3,c=(new SQR.V3(0,1,0),new SQR.V3(0,0,1),function(e){var a,r;return i.copyFrom(e),i.norm(),a=1-(.5+Math.atan2(i.z,i.x)/SQR.TWOPI),r=1-(.5-Math.asin(i.y)/Math.PI),new SQR.V2(a,r)}),f=function(e,a,r,n,o,s){var u=c(e),i=c(a),f=c(r),l=(new SQR.Face).setPosition(e,a,r).setUV(u,i,f).setColor(n,o,s);t.push(l)},l=function(a,r){for(var t=n.length,o=0;t>o;o++){var s=n[o],u=s.__v1==a&&s.__v2==r,i=s.__v2==a&&s.__v1==r;if(u||i)return s}var c=new SQR.V3;return c.sub(a,r).mul(.5).add(c,r).norm().mul(e),c.__v1=a,c.__v2=r,n.push(c),c.normal=c.clone(),c},S=function(){o[s]={};var e=o[s];e.faces=t,e.vectors=n,t=[];for(var a=e.faces.length,r=0;a>r;r++){var i=e.faces[r],c=l(i.a,i.b),S=l(i.a,i.c),v=l(i.b,i.c),Q=u[s+1];f(i.a,c,S,i.ca,Q,Q),f(i.b,v,c,i.cb,Q,Q),f(i.c,S,v,i.cc,Q,Q),f(c,v,S,Q,Q,Q)}s++},v=e,Q=.5*(1+Math.sqrt(5))*v,m=function(a,r,t){var o=new SQR.V3(a,r,t).norm();o.normal=o.clone(),o.mul(e),n.push(o)},R=function(e,a,r){var t=u[0];f(n[e],n[r],n[a],t,t,t)};for(m(-v,Q,0),m(v,Q,0),m(-v,-Q,0),m(v,-Q,0),m(0,-v,Q),m(0,v,Q),m(0,-v,-Q),m(0,v,-Q),m(Q,0,-v),m(Q,0,v),m(-Q,0,-v),m(-Q,0,v),R(0,11,5),R(0,5,1),R(0,1,7),R(0,7,10),R(0,10,11),R(1,5,9),R(5,11,4),R(11,10,2),R(10,7,6),R(7,1,8),R(3,9,4),R(3,4,2),R(3,2,6),R(3,6,8),R(3,8,9),R(4,9,5),R(2,4,11),R(6,2,10),R(8,6,7),R(9,8,1);a-->0;)S();var Q,h=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},3*t.length),d=0;return t.forEach(function(e){r.flatShading&&e.calculateNormal(),d+=e.toBuffer(h,d,!r.flatShading)}),h},SQR.Primitives.create2DQuad=function(e,a,r,t){return SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",e,a+t,e+r,a,e+r,a+t,e+r,a,e,a+t,e,a).data("aUV",0,0,1,1,1,0,1,1,0,0,0,1).update()},SQR.Primitives.createPlane=function(e,a,r,t,n,o){var s=[],u=[],i=[],c=new SQR.Buffer,f=f||{};c.width=e,c.height=a;var e=.5*e,a=.5*a,n=n||0,o=o||0,r=r||1,t=t||1;s.length=[];var l,S,v=-e+n,Q=-a+o,m=c.width/r,R=c.height/t;for(l=0;r+1>l;l++)for(u[l]=[],i[l]=[],S=0;t+1>S;S++){var h=v+l*m,d=Q+S*R;i[l][S]=new SQR.V2(l/r,S/t),u[l][S]=f.zUp?new SQR.V3(h,d,0):new SQR.V3(h,0,d)}for(l=0;r>l;l++)for(S=0;t>S;S++){var h=v+l*m,d=Q+S*R,V=u[l][S],w=u[l][S+1],P=u[l+1][S],p=u[l+1][S+1],b=i[l][S],g=i[l][S+1],N=i[l+1][S],U=i[l+1][S+1],_=(new SQR.Face).setPosition(V,w,P,p).setUV(b,g,N,U);s.push(_)}c.layout({aPosition:3,aNormal:3,aUV:2},r*t*6);var M=0;return s.forEach(function(e){M+=e.calculateNormal().toBuffer(c,M)}),c},SQR.Primitives.createPostEffect=function(e,a){SQR.fullScreenQuad=SQR.fullScreenQuad||SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",-1,1,1,1,1,-1,-1,1,1,-1,-1,-1).data("aUV",0,1,1,1,1,0,0,1,1,0,0,0).update();var r=new SQR.Transform;return r.buffer=SQR.fullScreenQuad,r.shader=SQR.Shader(e,a),r},SQR.Primitives.createImage=function(e,a,r,t){if(!r&&!SQR.GLSL)throw"> SQR.Primitives.createImage > sqr-glsl.js package is required to use this feature.";r=r||SQR.GLSL["post/image.glsl"];var n=new SQR.Transform;n.buffer=SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",-1,1,1,1,1,-1,-1,1,1,-1,-1,-1).data("aUV",0,1,1,1,1,0,0,1,1,0,0,0).update();var o=e,s=SQR.Texture(o);return n.shader=SQR.Shader(r,t),n.setImage=function(e){o=e,s.setSource(e).update(),n.shader.use().setUniform("uTexture",s)},n.setImage(o),n.size=function(e,r){var t=-1,s=1,u=1,i=-1,c=o.width,f=o.height,l=c/f*r,S=f/c*e;return"fit"==a?(l>e&&(i=-(S/r),s=S/r),S>r&&(t=-(l/e),u=l/e)):"cover"==a&&(l>e&&(t=-(l/e),u=l/e),S>r&&(i=-(S/r),s=S/r)),n.buffer.data("aPosition",t,s,u,s,u,i,t,s,u,i,t,i).update(),n},n},SQR.Primitives.createSphere=function(e,a,r,t){var n=[],o=[],s=[];t=t||{};var u,i,e=e||50,c=Math.max(3,Math.floor(a)||8),f=Math.max(3,Math.floor(r)||6),l=0,S=2*Math.PI,v=0,Q=Math.PI;for(i=0;f>=i;i++)for(u=0;c>=u;u++){var m=u/c,R=i/f,h=-e*Math.cos(l+m*S)*Math.sin(v+R*Q),d=e*Math.cos(v+R*Q),V=e*Math.sin(l+m*S)*Math.sin(v+R*Q);n.push(new SQR.V3(h,d,V)),o.push(new SQR.V2(m,1-R))}for(i=0;f>i;i++)for(u=0;c>u;u++){var w,P=c+1,p=n[i*P+u+0],b=n[i*P+u+1],g=n[(i+1)*P+u+1],N=n[(i+1)*P+u+0],U=o[i*P+u+0],_=o[i*P+u+1],M=o[(i+1)*P+u+1],F=o[(i+1)*P+u+0];w=t.reverseNormals?(new SQR.Face).setPosition(b,p,g,N).setUV(_,U,M,F):(new SQR.Face).setPosition(p,b,N,g).setUV(U,_,F,M),t.flatShading?w.calculateNormal():(p.normal=p.clone().norm(),b.normal=b.clone().norm(),g.normal=g.clone().norm(),N.normal=N.clone().norm(),t.reverseNormals&&(p.normal.neg(),b.normal.neg(),g.normal.neg(),N.normal.neg())),s.push(w)}var B=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*s.length),y=0;return s.forEach(function(e){y+=e.toBuffer(B,y,!t.flatShading)}),B};