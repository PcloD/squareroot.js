SQR.ConvexHull=function(){var t=[],n=[],e=[],r=function(t,n){return t.x==n.x?t.y-n.y:t.x-n.x},i=function(t,n,e){return e.x*t.y-e.y*t.x-(n.x*t.y-n.y*t.x)+(n.x*e.y-n.y*e.x)<0},a=function(t,n){n.push(t[0]),n.push(t[1]);for(var e=2,r=t.length;r>e;e++)for(n.push(t[e]);n.length>2&&!i(n[n.length-3],n[n.length-1],n[n.length-2]);)n.splice(n.indexOf(n[n.length-2]),1);return n},o=function(t,n){n.push(t[t.length-1]),n.push(t[t.length-2]);for(var e=t.length-3;e>=0;e--)for(n.push(t[e]);n.length>2&&!i(n[n.length-3],n[n.length-1],n[n.length-2]);)n.splice(n.indexOf(n[n.length-2]),1);return n};return{compute:function(i,s){return s||(s=e),t.length=0,n.length=0,s.length=0,i.sort(r),a(i,t),o(i,n),s=s.concat(t,n)}}}(),SQR.Delaunay=function(){function t(t,n){var r=[];return n=n.filter(function(n){return n.vertexInCircumcircle(t)?(r.push(new e(n.v0,n.v1)),r.push(new e(n.v1,n.v2)),r.push(new e(n.v2,n.v0)),!1):!0}),r=i(r),r.forEach(function(e){n.push(new SQR.Triangle(e.v0,e.v1,t))}),n}var n={},e=function(t,n){this.v0=t,this.v1=n};e.prototype.equals=function(t){return this.v0===t.v0&&this.v1===t.v1},e.prototype.inverse=function(){return new e(this.v1,this.v0)};var r=function(t){var n,e,r,i;t.forEach(function(t){(void 0===n||t.x<n)&&(n=t.x),(void 0===e||t.y<e)&&(e=t.y),(void 0===r||t.x>r)&&(r=t.x),(void 0===i||t.y>i)&&(i=t.y)});var a=10*(r-n),o=10*(i-e),s=new SQR.V2(n-a,e-3*o),u=new SQR.V2(n-a,i+o),h=new SQR.V2(r+3*a,i+o);return new SQR.Triangle(s,u,h)},i=function(t){for(var n=[],e=0;e<t.length;++e){for(var r=t[e],i=!0,a=0;a<t.length;++a)if(e!==a){var o=t[a];if(r.equals(o)||r.inverse().equals(o)){i=!1;break}}i&&n.push(r)}return n};return n.triangulate=function(n){var e=[],i=r(n);return e.push(i),n.forEach(function(n){e=t(n,e)}),e=e.filter(function(t){return!(t.v0==i.v0||t.v0==i.v1||t.v0==i.v2||t.v1==i.v0||t.v1==i.v1||t.v1==i.v2||t.v2==i.v0||t.v2==i.v1||t.v2==i.v2)})},n}(),SQR.GeometryTools=function(){var t={};return t.batch=function(t){var n=[],e=0,r=function(i){if(i.transformWorld(),i.numChildren>0)for(var a=0;a<i.numChildren;a++)r(i.children[a]);i.buffer&&(i.buffer.isIndexed()?console.warn("> SQR.GeometryTools.batch - indexed buffers can't be batched"):(n.push(i),e+=i.buffer.size)),i.shader&&!t.shader&&(t.shader=i.shader)};r(t);for(var i=SQR.Buffer().layout(n[0].buffer.layout,e),a=0,o=0,s=new SQR.V3,u=new SQR.Matrix33,h=0,c=0;c<n.length;c++){var v=n[c],l=n[c].buffer,f=new Float32Array(l.size*l.strideSize);f.set(l.getDataArray()),l.iterate("aPosition",function(t,n){s.set(n[t+0],n[t+1],n[t+2],1),v.globalMatrix.transformVector(s),f[t+0]=s.x,f[t+1]=s.y,f[t+2]=s.z}),l.iterate("aNormal",function(t,n){s.set(n[t+0],n[t+1],n[t+2]),v.globalMatrix.inverseMat3(u),u.transformVector(s),f[t+0]=s.x,f[t+1]=s.y,f[t+2]=s.z}),i.setRawData(f,a-o),a+=l.size*l.strideSize,h++}return t.removeAll(),t.buffer=i.update(),t},t}(),SQR.Shapes2d={circle:function(t,n){return function(e){e.beginPath(),e.fillStyle=n,e.arc(0,0,t,0,2*Math.PI),e.fill()}},triangleEq:function(t,n){return function(e){e.fillStyle=n,e.beginPath();var r=t;e.moveTo(Math.cos(30/180*Math.PI)*r,Math.sin(30/180*Math.PI)*r),e.lineTo(Math.cos(150/180*Math.PI)*r,Math.sin(150/180*Math.PI)*r),e.lineTo(Math.cos(Math.PI/-2)*r,Math.sin(Math.PI/-2)*r),e.fill()}},quad:function(t,n,e){return function(r){r.fillStyle=e,r.fillRect(t*-.5,n*-.5,t,n)}}},SQR.SpriteSheet=function(){var t,n,e,r,i={},a=document.createElement("canvas"),o=a.getContext("2d");return i.canvas=a,i.frame=0,i.layout=function(r,o,s){return t=r,n=o,e=s,a.width=n*e,a.height=t*e,i.numFrames=t*n,i.rows=t,i.cols=n,i.size=e,i},i.options=function(t){return r=t,i},i.renderToCanvas=function(t,r){var i=1==n?r:Math.floor(r/n),o=r%n;t.translate(e/-2,e/-2),t.drawImage(a,o*e,i*e,e,e,0,0,e,e)},i.draw=function(a){if(r&&void 0!==r.bgcolor?(o.fillStyle=r.bgcolor,o.fillRect(0,0,n*e,t*e)):(o.fillStyle="rgba(0, 0, 0, 0)",o.fillRect(0,0,n*e,t*e)),!a)return i;for(var s=0;t>s;s++)for(var u=0;n>u;u++){o.save();var h=r&&r.webglFlipY?(t-s-1)*e:s*e;o.translate(u*e,h),a.call(this,o,s*n+u),o.restore()}return i},i.run=function(t,n){var e=0,r=n||-1;console.log(r),t=t||1e3/60;var a=function(t){i.renderToCanvas(t,e)},o=setInterval(function(){e++,e>=i.numFrames&&(0!=r?(e=0,r--):a.stop())},t);return a.stop=function(){clearInterval(o)},a},i},SQR.TextureGenerator={noise:function(t,n,e,r,i){t=t||512,n=n||t,r=r||0,i=i||255;var a=e||document.createElement("canvas");a.width=t,a.height=n;for(var o=a.getContext("2d"),s=o.createImageData(t,n),u=s.data,h=0,c=u.length;c>h;h+=4)u[h+0]=r+Math.random()*(i-r)|0,u[h+1]=r+Math.random()*(i-r)|0,u[h+2]=r+Math.random()*(i-r)|0,u[h+3]=255;return o.putImageData(s,0,0),a}},SQR.Trackball=function(){var t={};t.rotation=new SQR.Quaternion;var n=function(t,n,e,r){e=e||.5,r=r||new SQR.V3;var i=t/e,a=n/e,o=i*i+a*a;return o>=1?r.set(i,a,0):r.set(i,a,Math.sqrt(1-o)),r.norm(),r},e=0,r=0,i=!1,a=new SQR.V3,o=new SQR.V3,s=new SQR.Quaternion,u=window.innerWidth/window.innerHeight,h=function(t){t="ontouchstart"in document?t.targetTouches[0]:t,e=(t.pageX/window.innerWidth*2-1)*u,r=-1*(t.pageY/window.innerHeight*2-1)},c=function(t){i=!0,h(t),n(e,r,1,a)},v=function(u){if(i){h(u),n(e,r,1,o);var c=SQR.V3.dot(a,o);a.cross(o,a),s.set(a.x,a.y,a.z,c),t.rotation.mul(s),a.copyFrom(o)}},l=function(){i=!1};return"ontouchstart"in document?(document.addEventListener("touchstart",c,!1),document.addEventListener("touchmove",v,!1),document.addEventListener("touchend",l,!1)):(document.addEventListener("mousedown",c,!1),document.addEventListener("mousemove",v,!1),document.addEventListener("mouseup",l,!1)),t},SQR.Triangle=function(t,n,e){this.v0=t,this.v1=n,this.v2=e,this.calculateCentroid=function(){this.centroid=new SQR.V2,this.centroid.x=(this.v0.x+this.v1.x+this.v2.x)/3,this.centroid.y=(this.v0.y+this.v1.y+this.v2.y)/3},this.calculateCircumCircle=function(){var t,n,e=this.v1.x-this.v0.x,r=this.v1.y-this.v0.y,i=this.v2.x-this.v0.x,a=this.v2.y-this.v0.y,o=e*(this.v0.x+this.v1.x)+r*(this.v0.y+this.v1.y),s=i*(this.v0.x+this.v2.x)+a*(this.v0.y+this.v2.y),u=2*(e*(this.v2.y-this.v1.y)-r*(this.v2.x-this.v1.x));if(Math.abs(u)<SQR.EPSILON){var h=Math.min(this.v0.x,this.v1.x,this.v2.x),c=Math.min(this.v0.y,this.v1.y,this.v2.y),v=Math.max(this.v0.x,this.v1.x,this.v2.x),l=Math.max(this.v0.y,this.v1.y,this.v2.y);this.circumCenter=new SQR.V2((h+v)/2,(c+l)/2),t=this.circumCenter.x-h,n=this.circumCenter.y-c}else{var f=(a*o-r*s)/u,d=(e*s-i*o)/u;this.circumCenter=new SQR.V2(f,d),t=this.circumCenter.x-this.v0.x,n=this.circumCenter.y-this.v0.y}this.circumRadiusSq=t*t+n*n,this.circumRadius=Math.sqrt(this.circumRadiusSq)},this.vertexInCircumcircle=function(t){this.circumCenter||this.calculateCircumCircle();var n=this.circumCenter.x-t.x,e=this.circumCenter.y-t.y,r=n*n+e*e;return r<=this.circumRadiusSq}};