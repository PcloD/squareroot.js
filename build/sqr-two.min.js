var SQR={TWOPI:2*Math.PI,HALFPI:.5*Math.PI,EPSILON:1e-6,gl:null,flipMatrix:!0,fullScreenQuad:null,shaderPath:".",Primitives:{V2:function(t,i){return new SQR.V2(t,i)},V3:function(t,i,n){return new SQR.V3(t,i,n)},Q:function(t,i,n,r){return new SQR.Quaternion(t,i,n,r)},M4:function(){return new SQR.Matrix44},F:function(t){var i=function(t,n,r,e){var s=SQR.Face().v(t,n,r,e);return i.faces.push(s),s};return i.faces=[],i.toBuffer=function(n){var r=0;return i.faces.forEach(function(i){t&&t.reverseNormals&&i.flip(),i.calculateNormal(),r+=i.toBuffer(n,r)}),r},i}},v2:function(){return{aPosition:2}},v3:function(){return{aPosition:3}},v2u2:function(){return{aPosition:2,aUV:2}},v2c3:function(){return{aPosition:2,aColor:3}},v3n3:function(){return{aPosition:3,aNormal:3}},v3n3u2:function(){return{aPosition:3,aNormal:3,aUV:2}},WARN_UNIFORM_NOT_PRESENT:!1};SQR.Version={version:"3.0",build:119,date:"Aug 12th 2015"},SQR.Bezier=function(t,i,n,r){var e=this;this.p0=t,this.c0=i,this.c1=n,this.p1=r;var s,a,o,h=SQR.Interpolation.bezierPosition,u=SQR.Interpolation.bezierVelocity;this.velocityAt=function(t,i){return a=a||this.p0.clone().set(),i=i||a,i.x=u(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),i.y=u(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==i.z&&null!==this.p0.z&&(i.z=u(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),i},this.valueAt=function(t,i){return s=s||this.p0.clone().set(),i=i||s,i.x=h(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),i.y=h(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==i.z&&null!==this.p0.z&&(i.z=h(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),i},this.matrixAt=function(t,i){o=o||new SQR.Matrix44,i=i||o,i.identity();var n=e.valueAt(t),r=e.velocityAt(t).norm(),s=SQR.V3.__tv1.set().cross(r,SQR.V3.up),a=SQR.V3.__tv2.set().cross(r,s);return i.data[0]=s.x,i.data[4]=a.x,i.data[8]=r.x,i.data[1]=s.y,i.data[5]=a.y,i.data[9]=r.y,i.data[2]=s.z,i.data[6]=a.z,i.data[10]=r.z,i.setTranslation(n.x,n.y,n.z),i}},SQR.Color=function(){var t,i={};return i.setRGB=function(t,n,r){return i.r=t||0,i.g=n||0,i.b=r||0,i},i.setHex=function(t){return t=0==t.indexOf("#")?t.substring(1):t,t=-1==t.indexOf("0x")?"0x"+t:t,t=parseInt(t),i.r=(t>>16&255)/255,i.g=(t>>8&255)/255,i.b=(255&t)/255,i},i.copyFrom=function(t){return i.r=t.r,i.g=t.g,i.b=t.b,i},i.lighten=function(t){return i.r=Math.min(1,i.r*t),i.g=Math.min(1,i.g*t),i.b=Math.min(1,i.b*t),i},i.clone=function(){return(new SQR.Color).setRGB(i.r,i.g,i.b)},i.mul=function(t){return i.r=Math.min(1,i.r*t),i.g=Math.min(1,i.g*t),i.b=Math.min(1,i.b*t),i},i.toUniform=function(){return t||(t=new Float32Array(3)),t[0]=i.r,t[1]=i.g,t[2]=i.b,t},i},SQR.Delaunay=function(){function t(t,i){var r=[];return i=i.filter(function(i){return i.vertexInCircumcircle(t)?(r.push(new n(i.v0,i.v1)),r.push(new n(i.v1,i.v2)),r.push(new n(i.v2,i.v0)),!1):!0}),r=e(r),r.forEach(function(n){i.push(new SQR.Triangle(n.v0,n.v1,t))}),i}var i={},n=function(t,i){this.v0=t,this.v1=i};n.prototype.equals=function(t){return this.v0===t.v0&&this.v1===t.v1},n.prototype.inverse=function(){return new n(this.v1,this.v0)};var r=function(t){var i,n,r,e;t.forEach(function(t){(void 0===i||t.x<i)&&(i=t.x),(void 0===n||t.y<n)&&(n=t.y),(void 0===r||t.x>r)&&(r=t.x),(void 0===e||t.y>e)&&(e=t.y)});var s=10*(r-i),a=10*(e-n),o=new SQR.V2(i-s,n-3*a),h=new SQR.V2(i-s,e+a),u=new SQR.V2(r+3*s,e+a);return new SQR.Triangle(o,h,u)},e=function(t){for(var i=[],n=0;n<t.length;++n){for(var r=t[n],e=!0,s=0;s<t.length;++s)if(n!==s){var a=t[s];if(r.equals(a)||r.inverse().equals(a)){e=!1;break}}e&&i.push(r)}return i};return i.triangulate=function(i){var n=[],e=r(i);return n.push(e),i.forEach(function(i){n=t(i,n)}),n=n.filter(function(t){return!(t.v0==e.v0||t.v0==e.v1||t.v0==e.v2||t.v1==e.v0||t.v1==e.v1||t.v1==e.v2||t.v2==e.v0||t.v2==e.v1||t.v2==e.v2)})},i}(),SQR.Interpolation={bezierPosition:function(t,i,n,r,e){return i*(1-t)*(1-t)*(1-t)+3*n*t*(1-t)*(1-t)+3*r*t*t*(1-t)+e*t*t*t},bezierVelocity:function(t,i,n,r,e){return 3*n-3*i+2*(3*i-6*n+3*r)*t+3*(-i+3*n-3*r+e)*t*t},linear:function(t,i,n){return t>=n?t:n>=i?i:(n=(n-t)/(i-t),t+(i-t)*n)},smoothStep:function(t){return 3*t*t-2*t*t*t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Math.clamp=function(t,i,n){return i>=t?i:t>=n?n:t},Math.clamp01=function(t){return 0>=t?0:t>=1?1:t},Math.getBoundsAtDistance=function(t,i,n,r){n=n||window.innerWidth,r=r||window.innerHeight;var e=n/r,s=Math.tan(t/180*Math.PI/2),a=i*s,o=a*e;return{w:o,h:a}},SQR.Matrix2D=function(){this.data=new Float32Array(9);var t,i,n,r,e;this.identity=function(t){return t=t||this.data,t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.transformVector=function(t){return n=this.data,r=t.x,e=t.y,t.x=n[0]*r+n[1]*e+n[2],t.y=n[3]*r+n[4]*e+n[5],t},this.setTranslation=function(t,i,r){return n=r||this.data,n[0]=1,n[3]=0,n[6]=t,n[1]=0,n[4]=1,n[7]=i,n[2]=0,n[5]=0,n[8]=1,this},this.getTranslation=function(t){return n=this.data,t=t||new SQR.V2,t.x=n[2],t.y=n[5],t},this.setScale=function(t,i,r){return n=r||this.data,n[0]=t,n[3]=0,n[6]=0,n[1]=0,n[4]=i,n[7]=0,n[2]=0,n[5]=0,n[8]=1,this},this.setShear=function(t,i,r){return n=r||this.data,n[0]=1,n[3]=t,n[6]=0,n[1]=i,n[4]=1,n[7]=0,n[2]=0,n[5]=0,n[8]=1,this},this.setRotation=function(t,i){n=i||this.data;var r=Math.cos(t),e=Math.sin(t);return n[0]=r,n[3]=-e,n[6]=0,n[1]=e,n[4]=r,n[7]=0,n[2]=0,n[5]=0,n[8]=1,this},this.setTRS=function(t,i,r,e,s){n=this.data;var a=Math.cos(r),o=Math.sin(r);return n[0]=a*e,n[3]=-o*s,n[6]=t,n[1]=o*e,n[4]=a*s,n[7]=i,n[2]=0,n[5]=0,n[8]=1,this},this.translate=function(t,i){return this.identity(SQR.Matrix2D.__temp),this.setTranslation(t,i,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.rotate=function(t){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.scale=function(t,i){return this.identity(SQR.Matrix2D.__temp),this.setScale(t,i,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.shear=function(t,i){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,i,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)};var s,a,o,h,u,c,y,f,p,v,l,x,Q,d,S,R,m,z;this.multiply=function(n){return t=this.data,i=n.data||n,s=t[0],a=t[3],o=t[6],h=t[1],u=t[4],c=t[7],y=t[2],f=t[5],p=t[8],v=i[0],l=i[3],x=i[6],Q=i[1],d=i[4],S=i[7],R=i[2],m=i[5],z=i[8],t[0]=s*v+a*Q+o*R,t[3]=s*l+a*d+o*m,t[6]=s*x+a*S+o*z,t[1]=h*v+u*Q+c*R,t[4]=h*l+u*d+c*m,t[7]=h*x+u*S+c*z,this},this.copyTo=function(n){return t=this.data,i=n.data||n,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],n},this.copyFrom=function(n){return t=n.data||n,i=this.data,i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},this.identity()},SQR.Matrix2D.__temp=new Float32Array(9),SQR.Matrix33=function(){this.data=new Float32Array(9),this.identity=function(){var t=this.data;return t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.transformVector=function(t,i){var n=this.data,r=t.x,e=t.y,s=t.z;return i=i||t,i.x=n[0]*r+n[3]*e+n[6]*s,i.y=n[1]*r+n[4]*e+n[7]*s,i.z=n[2]*r+n[5]*e+n[8]*s,i},this.determinant=function(){var t=this.data;return t[0]*(t[4]*t[8]-t[7]*t[5])+t[3]*(t[7]*t[2]-t[1]*t[8])+t[6]*(t[1]*t[5]-t[4]*t[2])},this.inverse=function(t){var i=this.data;t=t||this.data;var n,r=i[0],e=i[1],s=i[2],a=i[3],o=i[4],h=i[5],u=i[6],c=i[7],y=i[8],f=y*o-h*c,p=-y*a+h*u,v=c*a-o*u,i=r*f+e*p+s*v;return i?(n=1/i,t[0]=f*n,t[1]=(-y*e+s*c)*n,t[2]=(h*e-s*o)*n,t[3]=p*n,t[4]=(y*r-s*u)*n,t[5]=(-h*r+s*a)*n,t[6]=v*n,t[7]=(-c*r+e*u)*n,t[8]=(o*r-e*a)*n,t):(console.warn("Attempt to inverse a singular matrix33. ",this.data),t)},this.transpose=function(){var t=this.data,i=t[0],n=t[3],r=t[6],e=t[1],s=t[4],a=t[7],o=t[2],h=t[5],u=t[8];t[0]=i,t[1]=n,t[2]=r,t[3]=e,t[4]=s,t[5]=a,t[6]=o,t[7]=h,t[8]=u}},SQR.Matrix44=function(t){this.data=t||new Float32Array(16),this.identity=function(t){var i=t||this.data;return i[0]=1,i[4]=0,i[8]=0,i[12]=0,i[1]=0,i[5]=1,i[9]=0,i[13]=0,i[2]=0,i[6]=0,i[10]=1,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this},this.transformVector=function(t,i){var n=this.data,r=t.x,e=t.y,s=t.z,a=t.w;return i=i||t,i.x=n[0]*r+n[4]*e+n[8]*s+n[12]*a,i.y=n[1]*r+n[5]*e+n[9]*s+n[13]*a,i.z=n[2]*r+n[6]*e+n[10]*s+n[14]*a,i},this.rotateVector=function(t,i){{var n=this.data,r=t.x,e=t.y,s=t.z;t.w}return i=i||t,i.x=n[0]*r+n[4]*e+n[8]*s,i.y=n[1]*r+n[5]*e+n[9]*s,i.z=n[2]*r+n[6]*e+n[10]*s,i},this.multiply=function(t){var i,n,r,e,s,a,o,h,u,c,y,f,p,v,l,x,Q,d,S,R,m,z,w,M,V,g,_,A,C,P,b,T,q=this.data,F=t.data||t;return i=q[0],n=q[1],r=q[2],e=q[3],s=q[4],a=q[5],o=q[6],h=q[7],u=q[8],c=q[9],y=q[10],f=q[11],p=q[12],v=q[13],l=q[14],x=q[15],Q=F[0],d=F[1],S=F[2],R=F[3],m=F[4],z=F[5],w=F[6],M=F[7],V=F[8],g=F[9],_=F[10],A=F[11],C=F[12],P=F[13],b=F[14],T=F[15],q[0]=i*Q+s*d+u*S+p*R,q[1]=n*Q+a*d+c*S+v*R,q[2]=r*Q+o*d+y*S+l*R,q[3]=e*Q+h*d+f*S+x*R,q[4]=i*m+s*z+u*w+p*M,q[5]=n*m+a*z+c*w+v*M,q[6]=r*m+o*z+y*w+l*M,q[7]=e*m+h*z+f*w+x*M,q[8]=i*V+s*g+u*_+p*A,q[9]=n*V+a*g+c*_+v*A,q[10]=r*V+o*g+y*_+l*A,q[11]=e*V+h*g+f*_+x*A,q[12]=i*C+s*P+u*b+p*T,q[13]=n*C+a*P+c*b+v*T,q[14]=r*C+o*P+y*b+l*T,q[15]=e*C+h*P+f*b+x*T,this},this.setTQS=function(t,i,n,r,e,s,a,o,h,u,c){var y=c||this.data;this.identity(c);var f=e*e,p=s*s,v=a*a;return SQR.flipMatrix?(y[0]=(1-2*p-2*v)*o,y[1]=(2*e*s-2*a*r)*o,y[2]=(2*e*a+2*s*r)*o,y[4]=(2*e*s+2*a*r)*h,y[5]=(1-2*f-2*v)*h,y[6]=(2*s*a-2*e*r)*h,y[8]=(2*e*a-2*s*r)*u,y[9]=(2*s*a+2*e*r)*u,y[10]=(1-2*f-2*p)*u):(y[0]=(1-2*p-2*v)*o,y[4]=(2*e*s-2*a*r)*o,y[8]=(2*e*a+2*s*r)*o,y[1]=(2*e*s+2*a*r)*h,y[5]=(1-2*f-2*v)*h,y[9]=(2*s*a-2*e*r)*h,y[2]=(2*e*a-2*s*r)*u,y[6]=(2*s*a+2*e*r)*u,y[10]=(1-2*f-2*p)*u),y[12]=t,y[13]=i,y[14]=n,c||this},this.setTRS=function(t,i,n,r,e,s,a,o,h,u){var c=u||this.data;this.identity(u);var y=Math.sin(r),f=Math.cos(r),p=Math.sin(e),v=Math.cos(e),l=Math.sin(s),x=Math.cos(s);return SQR.flipMatrix?(c[0]=(v*x+p*y*l)*a,c[1]=(-v*l+p*y*x)*a,c[2]=p*f*a,c[4]=l*f*o,c[5]=x*f*o,c[6]=-y*o,c[8]=(-p*x+v*y*l)*h,c[9]=(l*p+v*y*x)*h,c[10]=v*f*h):(c[0]=(v*x+p*y*l)*a,c[4]=(-v*l+p*y*x)*a,c[8]=p*f*a,c[1]=l*f*o,c[5]=x*f*o,c[9]=-y*o,c[2]=(-p*x+v*y*l)*h,c[6]=(l*p+v*y*x)*h,c[10]=v*f*h),c[12]=t,c[13]=i,c[14]=n,u||this},this.setScale=function(t,i,n,r){var e=r||this.data;return e[0]=t,e[5]=i,e[10]=n,r||this},this.setTranslation=function(t,i,n,r){var e=r||this.data;return e[12]=t,e[13]=i,e[14]=n,r||this},this.setRotation=function(t,i,n,r){var e=r||this.data,s=Math.sin(t),a=Math.cos(t),o=Math.sin(i),h=Math.cos(i),u=Math.sin(n),c=Math.cos(n);return e[0]=h*c+o*s*u,e[1]=-h*u+o*s*c,e[2]=o*a,e[4]=u*a,e[5]=c*a,e[6]=-s,e[8]=-o*c+h*s*u,e[9]=u*o+h*s*c,e[10]=h*a,r||this},this.translate=function(t,i,n){return this.identity(SQR.Matrix44.__temp),this.setTranslation(t,i,n,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.rotate=function(t,i,n){return this.identity(SQR.Matrix44.__temp),this.setRotation(t,i,n,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.scale=function(t,i,n){return this.identity(SQR.Matrix44.__temp),this.setScale(t,i,n,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.copyTo=function(t){for(var i=this.data,n=t.data||t,r=0;16>r;r++)n[r]=i[r];return t},this.copyRotationTo=function(t){var i=this.data,n=t.data||t;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[4],n[4]=i[5],n[5]=i[6],n[6]=i[8],n[7]=i[9],n[8]=i[10],t},this.extractPosition=function(t){var i=this.data;return t.set(i[12],i[13],i[14]),t},this.determinant=function(){var t=this.data;return t[0]*(t[5]*t[10]-t[9]*t[6])+t[4]*(t[9]*t[2]-t[1]*t[10])+t[8]*(t[1]*t[6]-t[5]*t[2])},this.inverse=function(t){var i=this.data,n=t?t.data||t:this.data,r=i[0],e=i[1],s=i[2],a=i[3],o=i[4],h=i[5],u=i[6],c=i[7],y=i[8],f=i[9],p=i[10],v=i[11],l=i[12],x=i[13],Q=i[14],d=i[15],S=r*h-e*o,R=r*u-s*o,m=r*c-a*o,z=e*u-s*h,w=e*c-a*h,M=s*c-a*u,V=y*x-f*l,g=y*Q-p*l,_=y*d-v*l,A=f*Q-p*x,C=f*d-v*x,P=p*d-v*Q,b=S*P-R*C+m*A+z*_-w*g+M*V;return b?(b=1/b,n[0]=(h*P-u*C+c*A)*b,n[1]=(s*C-e*P-a*A)*b,n[2]=(x*M-Q*w+d*z)*b,n[3]=(p*w-f*M-v*z)*b,n[4]=(u*_-o*P-c*g)*b,n[5]=(r*P-s*_+a*g)*b,n[6]=(Q*m-l*M-d*R)*b,n[7]=(y*M-p*m+v*R)*b,n[8]=(o*C-h*_+c*V)*b,n[9]=(e*_-r*C-a*V)*b,n[10]=(l*w-x*m+d*S)*b,n[11]=(f*m-y*w-v*S)*b,n[12]=(h*g-o*A-u*V)*b,n[13]=(r*A-e*g+s*V)*b,n[14]=(x*R-l*z-Q*S)*b,n[15]=(y*z-f*R+p*S)*b,t):null},this.inverseMat3=function(t){var i=this.data,n=t.data,r=this.determinant();if(Math.abs(r)<1e-4)return console.warn("> SQR.Matrix44 - Attempt to inverse a singular matrix44. ",this.data),console.trace(),t;{var e=i[0],s=i[4],a=i[8],o=(i[12],i[1]),h=i[5],u=i[9],c=(i[13],i[2]),y=i[6],f=i[10];i[14]}return r=1/r,n[0]=(h*f-u*y)*r,n[1]=(a*y-s*f)*r,n[2]=(s*u-a*h)*r,n[3]=(u*c-o*f)*r,n[4]=(e*f-a*c)*r,n[5]=(a*o-e*u)*r,n[6]=(o*y-h*c)*r,n[7]=(s*c-e*y)*r,n[8]=(e*h-s*o)*r,t},this.transpose=function(t){var i=this.data,n=t?t.data||t:this.data,r=i[0],e=i[4],s=i[8],a=i[1],o=i[5],h=i[9],u=i[2],c=i[6],y=i[10];n[0]=r,n[1]=e,n[2]=s,n[4]=a,n[5]=o,n[6]=h,n[8]=u,n[9]=c,n[10]=y},this.lookAt=function(t,i){var n=this.data,r=SQR.V3.__tv1,e=SQR.V3.__tv2,s=SQR.V3.__tv3;return i=i||SQR.V3.up,s.set(n[12],n[13],n[14]),s.sub(s,t).norm(),0===s.magsq()&&(s.z=1),r.cross(i,s).norm(),0===r.magsq()&&(s.x+=1e-4,r.cross(i,s).norm()),e.cross(s,r),n[0]=r.x,n[4]=e.x,n[8]=s.x,n[1]=r.y,n[5]=e.y,n[9]=s.y,n[2]=r.z,n[6]=e.z,n[10]=s.z,this},t||this.identity()},SQR.Matrix44.__temp=new Float32Array(16),SQR.PerlinNoise=function(){for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],i=0;256>i;i++)t[256+i]=t[i];var n=function(t){return t*t*t*(t*(6*t-15)+10)},r=function(t,i,n){return i+t*(n-i)},e=function(t,i,n,r){var e=15&t,s=8>e?i:n,a=4>e?n:12==e||14==e?i:r;return(0==(1&e)?s:-s)+(0==(2&e)?a:-a)};return{noise:function(i,s,a){var o=~~i,h=~~s,u=~~a,c=255&o,y=255&h,f=255&u;i-=o,s-=h,a-=u;var p=i-1,v=s-1,l=a-1,x=n(i),Q=n(s),d=n(a),S=t[c]+y,R=t[S]+f,m=t[S+1]+f,z=t[c+1]+y,w=t[z]+f,M=t[z+1]+f;return r(d,r(Q,r(x,e(t[R],i,s,a),e(t[w],p,s,a)),r(x,e(t[m],i,v,a),e(t[M],p,v,a))),r(Q,r(x,e(t[R+1],i,s,l),e(t[w+1],p,s,a-1)),r(x,e(t[m+1],i,v,l),e(t[M+1],p,v,l))))}}}(),SQR.ProjectionMatrix=function(){"undefined"==typeof Float32Array&&(Float32Array=Array),this.data=new Float32Array(16),this.copyTo=function(t){for(var i=this.data,n=t.data||t,r=0;16>r;r++)n[r]=i[r];return t},this.identity()},SQR.ProjectionMatrix.prototype.identity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},SQR.ProjectionMatrix.prototype.screenPixels2d=function(){return this.orthographic(0,window.innerWidth,0,window.innerHeight,-1,1e3),this},SQR.ProjectionMatrix.prototype.orthographic=function(t,i,n,r,e,s){var a=this.data;this.near=e,this.far=s;var o=i-t,h=n-r,u=s-e,c=(i+t)/o,y=(n+r)/h,f=(s+e)/u;return a[0]=2/o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/h,a[9]=0,a[13]=-y,a[2]=0,a[6]=0,a[10]=-2/u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},SQR.ProjectionMatrix.prototype.perspective=function(t,i,n,r){this.near=n,this.far=r,this.fov=t;var e=this.data,s=n*Math.tan(t*Math.PI/360),a=r-n;return e[0]=n/(s*i),e[4]=0,e[8]=0,e[12]=0,e[1]=0,e[5]=n/s,e[9]=0,e[13]=0,e[2]=0,e[6]=0,e[10]=-(r+n)/a,e[14]=-(2*r*n)/a,e[3]=0,e[7]=0,e[11]=-1,e[15]=0,this},SQR.ProjectionMatrix.prototype.transformVector=function(t,i){var n=t.x,r=t.y,e=t.z,s=t.w,a=this.data;return i=i||t,i.x=a[0]*n+a[4]*r+a[8]*e+a[12]*s,i.y=a[1]*n+a[5]*r+a[9]*e+a[13]*s,i.z=a[2]*n+a[6]*r+a[10]*e+a[14]*s,i},SQR.ProjectionMatrix.prototype.inverse=function(t){var i=this.data;t=t||this.data;var n,r=i[0],e=i[1],s=i[2],a=i[3],o=i[4],h=i[5],u=i[6],c=i[7],y=i[8],f=i[9],p=i[10],v=i[11],l=i[12],x=i[13],Q=i[14],d=i[15],S=r*h-e*o,R=r*u-s*o,m=r*c-a*o,z=e*u-s*h,w=e*c-a*h,M=s*c-a*u,V=y*x-f*l,g=y*Q-p*l,_=y*d-v*l,A=f*Q-p*x,C=f*d-v*x,P=p*d-v*Q,b=S*P-R*C+m*A+z*_-w*g+M*V;return b?(n=1/b,t[0]=(h*P-u*C+c*A)*n,t[1]=(-e*P+s*C-a*A)*n,t[2]=(x*M-Q*w+d*z)*n,t[3]=(-f*M+p*w-v*z)*n,t[4]=(-o*P+u*_-c*g)*n,t[5]=(r*P-s*_+a*g)*n,t[6]=(-l*M+Q*m-d*R)*n,t[7]=(y*M-p*m+v*R)*n,t[8]=(o*C-h*_+c*V)*n,t[9]=(-r*C+e*_-a*V)*n,t[10]=(l*w-x*m+d*S)*n,t[11]=(-y*w+f*m-v*S)*n,t[12]=(-o*A+h*g-u*V)*n,t[13]=(r*A-e*g+s*V)*n,t[14]=(-l*z+x*R-Q*S)*n,t[15]=(y*z-f*R+p*S)*n,t):null},SQR.Quaternion=function(t,i,n,r){this.set(r,t,i,n)},SQR.Quaternion.prototype.set=function(t,i,n,r){return this.w=r||1,this.x=t||0,this.y=i||0,this.z=n||0,this},SQR.Quaternion.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,this},SQR.Quaternion.prototype.copyFrom=function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},SQR.Quaternion.prototype.identity=function(){return this.set(),this},SQR.Quaternion.prototype.mul=function(t,i){i=i||this;var n=i.w*t.w-i.x*t.x-i.y*t.y-i.z*t.z,r=i.w*t.x+i.x*t.w+i.y*t.z-i.z*t.y,e=i.w*t.y-i.x*t.z+i.y*t.w+i.z*t.x,s=i.w*t.z+i.x*t.y-i.y*t.x+i.z*t.w;return i.set(r,e,s,n),i.normalize(),i},SQR.Quaternion.prototype.dot=function(){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},SQR.Quaternion.prototype.lookAt=function(t,i){var n=SQR.Quaternion.__tv1,r=SQR.Quaternion.__tv2,e=SQR.Quaternion.__tv3;t.copyTo(n),i.copyTo(e),n.norm(),-1==n.z&&(n.x=1e-4,n.norm()),r.cross(e,n),e.cross(n,r),this.w=.5*Math.sqrt(1+r.x+e.y+n.z);var s=4*this.w;return this.x=(n.y-e.z)/s,this.y=(r.z-n.x)/s,this.z=(e.x-r.y)/s,this.normalize(),this},SQR.Quaternion.prototype.fromAngleAxis=function(t,i,n,r){var e=Math.sin(t/2);return this.x=i*e,this.y=n*e,this.z=r*e,this.w=Math.cos(t/2),this},SQR.Quaternion.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},SQR.Quaternion.prototype.normalize=function(){var t=this.mag();return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},SQR.Quaternion.prototype.neg=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},SQR.Quaternion.prototype.toMatrix=function(){throw"SQR.Quaternion.toMatrix() is not implemented. Check SQR.Matrix44.TQS()"},SQR.Quaternion.slerp=function(t,i,n,r){if(r=r||new SQR.Quaternion,0===n)return r.copyFrom(t);if(1===n)return r.copyFrom(i);var e=SQR.Quaternion.dot(t,i);0>e&&(t.neg(),e=SQR.Quaternion.dot(t,i));var s=Math.acos(e),a=Math.sqrt(1-e*e),o=Math.sin((1-n)*s)/a,h=Math.sin(n*s)/a;return Math.abs(e)>=1?(o=1,h=0):Math.abs(a)<.001&&(o=.5,h=.5),r.w=t.w*o+i.w*h,r.x=t.x*o+i.x*h,r.y=t.y*o+i.y*h,r.z=t.z*o+i.z*h,r},SQR.Quaternion.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w},SQR.Quaternion.prototype.slerp=function(t,i,n){return SQR.Quaternion.slerp(t,i,n,this),this},SQR.Quaternion.__tv1=new SQR.Quaternion,SQR.Quaternion.__tv2=new SQR.Quaternion,SQR.Quaternion.__tv3=new SQR.Quaternion,SQR.Spline=function(){var t,i,n=[],r=[],e=[],s={},a=function(n,r,e,s,a,o){var h=t.sub(n,r).neg(),u=i.sub(n,e),c=o>1?o:o*Math.min(h.mag(),u.mag());s.set().add(h,u).norm().mul(c),a.copyFrom(s).neg(),s.add(s,n),a.add(a,n)};return s.addSegment=function(n){var a;if(void 0!==n.x)a=n;else{var o=arguments,h=o.length;2==h?a=new SQR.V2(o[0],o[1]):3==h&&(a=new SQR.V3(o[0],o[1],o[2]))}return r.push(a),e.push(a.clone(),a.clone()),t||(t=r[0].clone(),i=r[0].clone()),s},s.create=function(t,i){if(r.length<2)return r;t=null!==t?t:.5,n.length=0;for(var o=r,h=e,u=r.length,c=0;u>c;c++){var y=o[c],f=h[2*c].set(),p=h[2*c+1].set(),v=0==c?o[u-1]:o[c-1],l=c==u-1?o[0]:o[c+1];a(y,v,l,f,p,t),h.push(f,p)}for(var c=0;u-1>c;c++){var v=o[c],l=c==u-1?o[0]:o[c+1],f=0!=c||i?h[2*c+1]:v,p=c!=u-2||i?h[2*c+2]:l,x=new SQR.Bezier(v,f,p,l);n.push(x)}if(i){var x=new SQR.Bezier(o[u-1],h[2*(u-1)+1],h[0],o[0]);n.push(x)}return s},s.valueAt=function(t,i){1==t&&(t=.999999),t%=1;var r=t*n.length;return n[0|r].valueAt(r%1,i)},s.velocityAt=function(t,i){1==t&&(t=.999999),t%=1;var r=t*n.length;return n[0|r].velocityAt(r%1,i)},s.matrixAt=function(t,i){0==t&&(t=SQR.EPSILON),1==t&&(t=1-SQR.EPSILON),t%=1;var r=t*n.length;return n[0|r].matrixAt(r%1,i)},Object.defineProperty(s,"segments",{get:function(){return r}}),Object.defineProperty(s,"points",{get:function(){return n}}),s},SQR.Triangle=function(t,i,n){this.v0=t,this.v1=i,this.v2=n,this.calculateCentroid=function(){this.centroid=new SQR.V2,this.centroid.x=(this.v0.x+this.v1.x+this.v2.x)/3,this.centroid.y=(this.v0.y+this.v1.y+this.v2.y)/3},this.calculateCircumCircle=function(){var t,i,n=this.v1.x-this.v0.x,r=this.v1.y-this.v0.y,e=this.v2.x-this.v0.x,s=this.v2.y-this.v0.y,a=n*(this.v0.x+this.v1.x)+r*(this.v0.y+this.v1.y),o=e*(this.v0.x+this.v2.x)+s*(this.v0.y+this.v2.y),h=2*(n*(this.v2.y-this.v1.y)-r*(this.v2.x-this.v1.x));if(Math.abs(h)<SQR.EPSILON){var u=Math.min(this.v0.x,this.v1.x,this.v2.x),c=Math.min(this.v0.y,this.v1.y,this.v2.y),y=Math.max(this.v0.x,this.v1.x,this.v2.x),f=Math.max(this.v0.y,this.v1.y,this.v2.y);this.circumCenter=new SQR.V2((u+y)/2,(c+f)/2),t=this.circumCenter.x-u,i=this.circumCenter.y-c}else{var p=(s*a-r*o)/h,v=(n*o-e*a)/h;this.circumCenter=new SQR.V2(p,v),t=this.circumCenter.x-this.v0.x,i=this.circumCenter.y-this.v0.y}this.circumRadiusSq=t*t+i*i,this.circumRadius=Math.sqrt(this.circumRadiusSq)},this.vertexInCircumcircle=function(t){this.circumCenter||this.calculateCircumCircle();var i=this.circumCenter.x-t.x,n=this.circumCenter.y-t.y,r=i*i+n*n;return r<=this.circumRadiusSq}},SQR.V2=function(t,i){this.set(t,i),this.size=2},SQR.V2.prototype.set=function(t,i){return this.x=t||0,this.y=i||0,this},SQR.V2.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t},SQR.V2.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},SQR.V2.prototype.clone=function(){return new SQR.V2(this.x,this.y)},SQR.V2.prototype.magsq=function(){return this.x*this.x+this.y*this.y},SQR.V2.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V2.prototype.isZero=function(){return 0==this.x&&0==this.y},SQR.V2.prototype.mul=function(t){return this.x*=t,this.y*=t,this},SQR.V2.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},SQR.V2.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t),this},SQR.V2.prototype.add=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},SQR.V2.prototype.sub=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},SQR.V2.prototype.lerp=function(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this},SQR.V2.dot=function(t,i){return t.x*i.x+t.y*i.y},SQR.V2.prototype.perp=function(){return this.set(this.y,-this.x),this},SQR.V2.prototype.toUniform=function(){return this.toArray()},SQR.V2.prototype.toArray=function(){return this.array||(this.array=new Float32Array(2)),this.array[0]=this.x,this.array[1]=this.y,this.array},SQR.V3=function(t,i,n){this.set(t,i,n),this.size=3},SQR.V3.prototype.set=function(t,i,n,r){return this.x=t||0,this.y=i||0,this.z=n||0,this.w=r||1,this},SQR.V3.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,void 0!=t.z&&(t.z=this.z),t},SQR.V3.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z||0,this},SQR.V3.prototype.clone=function(){return new SQR.V3(this.x,this.y,this.z)},SQR.V3.prototype.magsq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},SQR.V3.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V3.prototype.isZero=function(){},SQR.V3.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},SQR.V3.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},SQR.V3.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t,this.z*t),this},SQR.V3.prototype.add=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},SQR.V3.prototype.sub=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},SQR.V3.prototype.lerp=function(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this},SQR.V3.prototype.random=function(){return this.x=2*Math.random()-1,this.y=2*Math.random()-1,this.z=2*Math.random()-1,this},SQR.V3.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},SQR.V3.prototype.cross=function(t,i){var n=t.y*i.z-t.z*i.y,r=t.z*i.x-t.x*i.z,e=t.x*i.y-t.y*i.x;return this.set(n,r,e,this.w),this},SQR.V3.prototype.toUniform=function(){return this.toArray()},SQR.V3.prototype.toArray=function(){return this.array||(this.array=new Float32Array(3)),this.array[0]=this.x,this.array[1]=this.y,this.array[2]=this.z,this.array},SQR.V3.prototype.toScreenSpace=function(t,i){t=t||window.innerWidth,i=i||window.innerHeight,this.x=this.x/this.z*t/2+t/2,this.y=this.y/this.z*i/2+i/2,this.y=i-this.y},SQR.V3.prototype.addNormal=function(t){this.normal||(this.normal=new SQR.V3),this.normal.add(this.normal,t)},SQR.V3.prototype.resetNormal=function(){this.normal&&this.normal.set()},SQR.V3.up=new SQR.V3(0,1,0),SQR.V3.forward=new SQR.V3(0,0,1),SQR.V3.__tv1=new SQR.V3,SQR.V3.__tv2=new SQR.V3,SQR.V3.__tv3=new SQR.V3,SQR.CanvasRenderer=function(t){var i={},n=null,r="> SQR.Context - Invalid canvas reference.";if(t||(t=document.createElement("canvas")),t instanceof HTMLElement||(t=document.querySelector(t)),!t.getContext)throw r;var e=t.getContext("2d");return e.setLineDash||(e.setLineDash=function(){}),i.canvas=t,i.setSize=function(n,r){return t.width=n,t.height=r,i},i.setClearColor=function(t){return n=t,i},i.render=function(i){n?(n.indexOf("rgba")>-1&&e.clearRect(0,0,t.width,t.height),e.fillStyle=n,e.fillRect(0,0,t.width,t.height)):e.clearRect(0,0,t.width,t.height),i&&i.draw(e)},i},SQR.Transform2d=function(t){var i={};return i.name=t||"sqr.transform."+SQR.Transform2dCount++,i.position=new SQR.V3(0,0,0),i.rotation=0,i.scale=new SQR.V2(1,1),i.alpha=1,i.children=[],i.numChildren=0,i.add=function(){for(var t=0;t<arguments.length;t++){var n=arguments[t];n.parent=i,-1==i.children.indexOf(n)&&i.children.push(n)}return i.numChildren=i.children.length,i},i.remove=function(){for(var t=0;t<arguments.length;t++){var n=arguments[t],r=i.children.indexOf(n);if(-1==r)return!1;n.parent=null,i.children.splice(r,1)}return i.numChildren=i.children.length,i},i.removeAll=function(){i.children.length=0,i.numChildren=0},i.contains=function(t){return i.children.indexOf(t)>-1},i.recurse=function(t,n){n||t(i);for(var r=0;r<i.numChildren;r++)i.children[r].recurse(t)},i.draw=function(t){var n=t;n.save(),n.translate(i.position.x,i.position.y),n.rotate(i.rotation),n.scale(i.scale.x,i.scale.y);for(var r=0;r<i.numChildren;r++)i.children[r].draw(n);i.alpha<1&&(n.globalAlpha=i.alpha),i.shape&&i.shape(n),n.restore()},i},SQR.Transform2dCount=0;