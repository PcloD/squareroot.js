SQR.Primitives.createPoint=function(e,a){return SQR.Buffer().layout(SQR.v2(),1).setMode(SQR.gl.POINTS).data("aPosition",e||0,a||0).update()},SQR.Primitives.createCube=function(e,a,r){e=e||1,a=a||1,r=r||1;var t=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},36),n=new SQR.V3(e*-.5,.5*a,.5*r),o=new SQR.V3(.5*e,.5*a,.5*r),s=new SQR.V3(e*-.5,a*-.5,.5*r),u=new SQR.V3(.5*e,a*-.5,.5*r),i=new SQR.V3(e*-.5,.5*a,r*-.5),c=new SQR.V3(.5*e,.5*a,r*-.5),f=new SQR.V3(e*-.5,a*-.5,r*-.5),l=new SQR.V3(.5*e,a*-.5,r*-.5),S=new SQR.V2(0,1),v=new SQR.V2(1,1),Q=new SQR.V2(0,0),R=new SQR.V2(1,0),m=[];m.push(SQR.Face().setPosition(n,o,s,u).setUV(S,v,Q,R)),m.push(SQR.Face().setPosition(c,i,l,f).setUV(S,v,Q,R)),m.push(SQR.Face().setPosition(i,n,f,s).setUV(S,v,Q,R)),m.push(SQR.Face().setPosition(o,c,u,l).setUV(S,v,Q,R)),m.push(SQR.Face().setPosition(i,c,n,o).setUV(S,v,Q,R)),m.push(SQR.Face().setPosition(s,u,f,l).setUV(S,v,Q,R));var h=0;return m.forEach(function(e){h+=e.calculateNormal().toBuffer(t,h)}),t},SQR.Primitives.createCylinder=function(e,a,r,t){t=t||{};var n,o,s,u,i,c,f=[],l=function(e,a,r,t,n,o,s,u){var i=(new SQR.Face).setPosition(e,a,r,t).setUV(n,o,s,u);f.push(i)};n=[],o=[],s=[],u=[];for(var S=0;r>S;S++){var v=new SQR.V3,Q=new SQR.V3,R=new SQR.V2,m=new SQR.V2,h=Math.cos(S/r*SQR.TWOPI)*a,d=Math.sin(S/r*SQR.TWOPI)*a;t.vertical?(v.set(d,e*-.5,h),Q.set(d,.5*e,h)):(v.set(e*-.5,h,d),Q.set(.5*e,h,d)),R.set(S/r,0),m.set(S/r,1),t.noCaps||(t.vertical?(i=new SQR.V3(0,e*-.5,0),c=new SQR.V3(0,.5*e,0)):(i=new SQR.V3(e*-.5,0,0),c=new SQR.V3(.5*e,0,0))),n.push(v),o.push(Q),s.push(R),u.push(m),t.insideFaces&&(v._inside=v.clone(),Q._inside=Q.clone())}for(var S=0;r>S;S++){var V=n[S],w=o[S],P=s[S],p=u[S],b=(S+1)%r,g=n[b],N=o[b],_=s[b],U=u[b];l(V,w,g,N,P,p,_,U),t.noCaps?t.insideFaces&&l(V._inside,g._inside,w._inside,N._inside,P,p,_,U):(l(V,g,i,null,p,U,_),l(N,w,c,null,U,p,_))}var v,F=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*f.length),M=0;return f.forEach(function(e){M+=e.calculateNormal().toBuffer(F,M)}),F},SQR.Extrude=function(){var e={};e.buffer=SQR.Buffer();var a,r,t,n,o,s,u,i=[],c=[];e.setPaths=function(o,s,u,i){return a=o,r=o.length,t=s,n=u||10,f(i),e},e.makeCaps=function(){return e};var f=function(a){i.length=0,c.length=0,a=a||SQR.v3n3();for(var t=0;n>t;t++)for(var o=0;r>o;o++){var s=new SQR.V3;i.push(s)}for(var t=0;n-1>t;t++)for(var o=0;r>o;o++){var u=t*r+o,f=r-1>o?u+1:t*r,l=(t+1)*r+o,S=r-1>o?l+1:(t+1)*r,v=(new SQR.Face).setPosition(i[u],i[S],i[f]),Q=(new SQR.Face).setPosition(i[u],i[l],i[S]);c.push(v,Q)}e.buffer.layout(a,3*c.length)},l=function(u){for(var f=0;n>f;f++)for(var l=f/(n-1),S=s+l*o,v=t.matrixAt(S),Q=0;r>Q;Q++){var R=i[f*r+Q];R.copyFrom(a[Q]),u&&u(l,R),v.transformVector(R)}for(var m=0,f=0,h=c.length;h>f;f++)m+=c[f].calculateNormal().toBuffer(e.buffer,m,!1,!0)};return e.update=function(a,r,t){return s=a||0,u=r||1,o=u-s,l(t),e.buffer.update(),e},e},SQR.Face=function(){var e={},a="aPosition",r="aNormal",t="aUV";return e.setPosition=function(a,r,t,n){return e.a=a,e.b=r,e.c=t,e.d=n,e},e.setNormal=function(a){return e.normal=a,e},e.setUV=function(a,r,t,n){return e.uva=a,e.uvb=r,e.uvc=t,e.uvd=n,e},e.setColor=function(a,r,t,n){return e.ca=a,e.cb=r,e.cc=t,e.cd=n,e},e.calculateNormal=function(){var a=SQR.V3.__tv1,r=SQR.V3.__tv2;return e.normal=new SQR.V3,a.sub(e.a,e.b),a.isZero()&&a.sub(e.a,e.d),r.sub(e.c,e.a),e.normal.cross(a,r),e},e.addNormalToVertices=function(){return e.a.addNormal(e.normal),e.b.addNormal(e.normal),e.c.addNormal(e.normal),e.d&&e.d.addNormal(e.normal),e},e.toBuffer=function(n,o,s,u){var i=o;if(n.attributes[a]&&(n.set(a,i+0,e.a).set(a,i+1,e.b).set(a,i+2,e.c),e.d&&n.set(a,i+3,e.c).set(a,i+4,e.b).set(a,i+5,e.d)),n.attributes[r]&&(e.normal||s)){var c=s,f=e.normal;u&&!c&&e.normal.norm(),n.set(r,i+0,c?e.a.normal:f).set(r,i+1,c?e.b.normal:f).set(r,i+2,c?e.c.normal:f),e.d&&n.set(r,i+3,c?e.c.normal:f).set(r,i+4,c?e.b.normal:f).set(r,i+5,c?e.d.normal:f)}return n.attributes[t]&&e.uva&&(n.set(t,i+0,e.uva).set(t,i+1,e.uvb).set(t,i+2,e.uvc),e.d&&n.set(t,i+3,e.uvc).set(t,i+4,e.uvb).set(t,i+5,e.uvd)),e.d?6:3},e},SQR.Primitives.createIcosphere=function(e,a,r){var t=[],n=[],o=[],s=0;r=r||{};var u=[[1,0,0,1],[0,1,0,2],[0,0,1,3],[1,1,0,4],[0,1,1,5]],i=new SQR.V3,c=(new SQR.V3(0,1,0),new SQR.V3(0,0,1),function(e){var a,r;return i.copyFrom(e),i.norm(),a=1-(.5+Math.atan2(i.z,i.x)/SQR.TWOPI),r=1-(.5-Math.asin(i.y)/Math.PI),new SQR.V2(a,r)}),f=function(e,a,r,n,o,s){var u=c(e),i=c(a),f=c(r),l=(new SQR.Face).setPosition(e,a,r).setUV(u,i,f).setColor(n,o,s);t.push(l)},l=function(a,r){for(var t=n.length,o=0;t>o;o++){var s=n[o],u=s.__v1==a&&s.__v2==r,i=s.__v2==a&&s.__v1==r;if(u||i)return s}var c=new SQR.V3;return c.sub(a,r).mul(.5).add(c,r).norm().mul(e),c.__v1=a,c.__v2=r,n.push(c),c.normal=c.clone(),c},S=function(){o[s]={};var e=o[s];e.faces=t,e.vectors=n,t=[];for(var a=e.faces.length,r=0;a>r;r++){var i=e.faces[r],c=l(i.a,i.b),S=l(i.a,i.c),v=l(i.b,i.c),Q=u[s+1];f(i.a,c,S,i.ca,Q,Q),f(i.b,v,c,i.cb,Q,Q),f(i.c,S,v,i.cc,Q,Q),f(c,v,S,Q,Q,Q)}s++},v=e,Q=.5*(1+Math.sqrt(5))*v,R=function(a,r,t){var o=new SQR.V3(a,r,t).norm();o.normal=o.clone(),o.mul(e),n.push(o)},m=function(e,a,r){var t=u[0];f(n[e],n[r],n[a],t,t,t)};for(R(-v,Q,0),R(v,Q,0),R(-v,-Q,0),R(v,-Q,0),R(0,-v,Q),R(0,v,Q),R(0,-v,-Q),R(0,v,-Q),R(Q,0,-v),R(Q,0,v),R(-Q,0,-v),R(-Q,0,v),m(0,11,5),m(0,5,1),m(0,1,7),m(0,7,10),m(0,10,11),m(1,5,9),m(5,11,4),m(11,10,2),m(10,7,6),m(7,1,8),m(3,9,4),m(3,4,2),m(3,2,6),m(3,6,8),m(3,8,9),m(4,9,5),m(2,4,11),m(6,2,10),m(8,6,7),m(9,8,1);a-->0;)S();var Q,h=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},3*t.length),d=0;return t.forEach(function(e){r.flatShading&&e.calculateNormal(),d+=e.toBuffer(h,d,!r.flatShading)}),h},SQR.Primitives.create2DQuad=function(e,a,r,t){return SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",e,a+t,e+r,a,e+r,a+t,e+r,a,e,a+t,e,a).data("aUV",0,0,1,1,1,0,1,1,0,0,0,1).update()},SQR.Primitives.createPlane=function(e,a,r,t,n,o){var s=[],u=[],i=[],c=new SQR.Buffer,f=f||{};c.width=e,c.height=a;var e=.5*e,a=.5*a,n=n||0,o=o||0,r=r||1,t=t||1;s.length=[];var l,S,v=-e+n,Q=-a+o,R=c.width/r,m=c.height/t;for(l=0;r+1>l;l++)for(u[l]=[],i[l]=[],S=0;t+1>S;S++){var h=v+l*R,d=Q+S*m;i[l][S]=new SQR.V2(l/r,S/t),u[l][S]=f.zUp?new SQR.V3(h,d,0):new SQR.V3(h,0,d)}for(l=0;r>l;l++)for(S=0;t>S;S++){var h=v+l*R,d=Q+S*m,V=u[l][S],w=u[l][S+1],P=u[l+1][S],p=u[l+1][S+1],b=i[l][S],g=i[l][S+1],N=i[l+1][S],_=i[l+1][S+1],U=(new SQR.Face).setPosition(V,w,P,p).setUV(b,g,N,_);s.push(U)}c.layout({aPosition:3,aNormal:3,aUV:2},r*t*6);var F=0;return s.forEach(function(e){F+=e.calculateNormal().toBuffer(c,F)}),c},SQR.Primitives.createPostEffect=function(e,a){SQR.fullScreenQuad=SQR.fullScreenQuad||SQR.Buffer().layout(SQR.v2u2(),6).data("aPosition",-1,1,1,1,1,-1,-1,1,1,-1,-1,-1).data("aUV",0,1,1,1,1,0,0,1,1,0,0,0).update();var r=new SQR.Transform;return r.buffer=SQR.fullScreenQuad,r.shader=SQR.Shader(e,a),r},SQR.Primitives.createSphere=function(e,a,r,t){var n=[],o=[],s=[];t=t||{};var u,i,e=e||50,c=Math.max(3,Math.floor(a)||8),f=Math.max(3,Math.floor(r)||6),l=0,S=2*Math.PI,v=0,Q=Math.PI;for(i=0;f>=i;i++)for(u=0;c>=u;u++){var R=u/c,m=i/f,h=-e*Math.cos(l+R*S)*Math.sin(v+m*Q),d=e*Math.cos(v+m*Q),V=e*Math.sin(l+R*S)*Math.sin(v+m*Q);n.push(new SQR.V3(h,d,V)),o.push(new SQR.V2(R,1-m))}for(i=0;f>i;i++)for(u=0;c>u;u++){var w,P=c+1,p=n[i*P+u+0],b=n[i*P+u+1],g=n[(i+1)*P+u+1],N=n[(i+1)*P+u+0],_=o[i*P+u+0],U=o[i*P+u+1],F=o[(i+1)*P+u+1],M=o[(i+1)*P+u+0];w=t.reverseNormals?(new SQR.Face).setPosition(b,p,g,N).setUV(U,_,F,M):(new SQR.Face).setPosition(p,b,N,g).setUV(_,U,M,F),t.flatShading?w.calculateNormal():(p.normal=p.clone().norm(),b.normal=b.clone().norm(),g.normal=g.clone().norm(),N.normal=N.clone().norm(),t.reverseNormals&&(p.normal.neg(),b.normal.neg(),g.normal.neg(),N.normal.neg())),s.push(w)}var B=SQR.Buffer().layout({aPosition:3,aNormal:3,aUV:2},6*s.length),y=0;return s.forEach(function(e){y+=e.toBuffer(B,y,!t.flatShading)}),B};