SQR={TWOPI:2*Math.PI,HALFPI:.5*Math.PI,EPSILON:1e-6,gl:null,fullScreenQuad:null,shaderPath:".",Primitives:{},v2:function(){return{aPosition:2}},v3:function(){return{aPosition:3}},v2u2:function(){return{aPosition:2,aUV:2}},v2c3:function(){return{aPosition:2,aColor:3}},v3n3:function(){return{aPosition:3,aNormal:3}},v3n3u2:function(){return{aPosition:3,aNormal:3,aUV:2}},WARN_UNIFORM_NOT_PRESENT:!1},SQR.Version={version:"3",build:16,date:"2015-01-09T02:15:43.316Z"},SQR.Buffer=function(){var e,r,t,n,a={},i=!1;return a.mode=SQR.gl.TRIANGLES,a.setMode=function(e){return a.mode=e,a},a.layout=function(r,t){a.size=t,a.strideSize=0,a.layout=r,a.attributes={};for(var n in r){var i={offset:a.strideSize,byteOffset:4*a.strideSize,size:r[n]};a.strideSize+=r[n],a.attributes[n]=i}return a.strideByteSize=4*a.strideSize,e=new Float32Array(t*a.strideSize),a},a.data=function(r,t){t instanceof Array||(t=Array.prototype.slice.call(arguments,1));for(var n=a.attributes[r],i=t.length/n.size,o=0;i>o;o++)for(var u=0;u<n.size;u++)e[o*a.strideSize+u+n.offset]=t[o*n.size+u];return a},a.set=function(r,t,n){n.toArray?n=n.toArray():n instanceof Array||(n=Array.prototype.slice.call(arguments,2));for(var i=a.attributes[r],o=0;o<i.size;o++)e[t*a.strideSize+o+i.offset]=n[o];return a},a.iterate=function(r,t){for(var n=a.attributes[r],i=0,o=0;o<e.length;o+=a.strideSize)t(o+n.offset,e,i),i++;return a},a.bind=function(){return SQR.gl.bindBuffer(SQR.gl.ARRAY_BUFFER,t),a},a.update=function(){var o=SQR.gl;return t=t||o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,t),o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW),i&&(n=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),o.bufferData(o.ELEMENT_ARRAY_BUFFER,r,o.STATIC_DRAW)),a},a.index=function(e){return e instanceof Array||(e=Array.prototype.slice.call(arguments,0)),r=new Uint16Array(e),a.indexSize=e.length,i=!0,a},a.isIndexed=function(){return i},a.draw=function(){var e=SQR.gl;i?e.drawElements(a.mode,a.indexSize,e.UNSIGNED_SHORT,0):e.drawArrays(a.mode,0,a.size)},a.setRawData=function(r,t){e.set(r,t)},a.getDataArray=function(){return e},a.destroy=function(){e.length=0,SQR.gl.deleteBuffer(t),i&&(r.length=0,SQR.gl.deleteBuffer(n))},a},SQR.Context=function(e){!SQR._versionDisplayed&&SQR.Version&&(console.log("Squareroot v"+SQR.Version.version+" b"+SQR.Version.build),SQR._versionDisplayed=!0);var r="> SQR.Context - Webgl is not supported.",t="> SQR.Context - Invalid canvas reference.";if(e||(e=document.createElement("canvas")),e instanceof HTMLElement||(e=document.querySelector(e)),!e.getContext)throw t;var n,a={canvas:e};return a.create=function(t,i){i=i||function(){throw r},t=t||{},void 0===t.antialias&&(t.antialias=!0),window.WebGLRenderingContext||i();try{n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}catch(o){console.error(o),i()}return a.gl=n,a.setAsCurrent(),a},a.size=function(r,t){return e.width=r,e.height=t,n.viewport(0,0,r,t),a},a.clearColor=function(e,r,t,i){return n.clearColor(e,r,t,i),a},a.clear=function(){return n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),a},a.setAsCurrent=function(){return SQR.gl=n,a},a},SQR.Cubemap=function(e,r){var t={};t.tex=SQR.gl.createTexture();var n=6,a={};r=r||{};var i=function(){var e=SQR.gl;e.bindTexture(e.TEXTURE_CUBE_MAP,t.tex),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.right),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.left),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.up),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.down),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.front),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.back),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null),r.onLoad&&r.onLoad()},o=function(){n--,0>=n&&i()},u=function(e,r){"string"==typeof r?(a[e]=new Image,a[e].onload=o,a[e].src=r):(r instanceof Image||r.getContext)&&(a[e]=r,o())};return e.left?(u("left",e.left),u("right",e.right),u("up",e.up),u("down",e.down),u("back",e.back),u("front",e.front)):(u("left",e),u("right",e),u("up",e),u("down",e),u("back",e),u("front",e)),t},SQR.FrameBuffer=function(e,r,t,n){t=t||1;var a={},i=SQR.gl;if(a.texture=i.createTexture(),a.depthBuffer=i.createRenderbuffer(),n){i.bindTexture(i.TEXTURE_CUBE_MAP,a.texture),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);for(var o=0;6>o;o++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,a.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,r);var u=function(e){var r=i.createFramebuffer();return i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,a.texture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,a.depthBuffer),i.bindFramebuffer(i.FRAMEBUFFER,null),r};a.faces={right:u(0),left:u(1),up:u(2),down:u(3),front:u(4),back:u(5)},i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null)}else a.fbo=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,a.fbo),i.bindTexture(i.TEXTURE_2D,a.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,a.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a.texture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,a.depthBuffer),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null);return a.bind=function(t){var n=a.faces?a.faces[t]:a.fbo;i.viewport(0,0,e,r),i.bindFramebuffer(i.FRAMEBUFFER,n)},a.resize=function(n,o){e=n*t|0,r=o*t|0,i.bindFramebuffer(i.FRAMEBUFFER,a.fbo),i.bindTexture(i.TEXTURE_2D,a.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,a.depthBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,r)},a},SQR.Loader={loadText:function(e,r){var t=new XMLHttpRequest;t.open("GET",e);var n=function(){4==t.readyState&&(t.removeEventListener("readystatechange",n),r(t.responseText,e))};t.addEventListener("readystatechange",n),t.send()},loadJSON:function(e,r){SQR.Loader.loadText(e,function(t){r(JSON.parse(t),e)})},loadImage:function(e,r){var t=new Image;if(r){var n=function(){t.removeEventListener("load",n),r(t,e)};t.addEventListener("load",n)}return t.src=e,t},loadWebcam:function(e,r){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia||(console.error("> SQR.Loader - getUserMedia not supported"),e()),r=r||{audio:!1,video:{}};var t=function(e){a.stream=e,a.src=window.URL.createObjectURL(e),a.play(),a.addEventListener("canplaythrough",n,!1)},n=function(){e(a,"webcam")},a=document.createElement("video");a.autoplay=!0,navigator.getUserMedia(r,t,function(e){console.error("> SQR.Loader - getUserMedia error ",e)})},loadVideo:function(e,r){var t=function(){r(n,e)},n=document.createElement("video");n.autoplay=!0,n.addEventListener("canplaythrough",t,!1);var a=e;n.canPlayType("video/mp4")||(a=a.replace("mp4","webm")),n.src=a},loadAssets:function(e,r,t){var n=e.length;SQR.Loader.assets={};for(var a={},i=function(i,o){SQR.Loader.assets[a[o]||o]=i,n--,t&&t(n,e.length),0==n&&r(SQR.Loader.assets)},o=0;n>o;o++){var u=e[o];"string"!=typeof u&&(a[u[0]]=u[1],u=u[0]);var f=u.substring(u.lastIndexOf(".")+1);if(u.indexOf("~")>-1){if(SQR.GLSL&&SQR.GLSL[u.substring(2)]){n--;continue}u=u.replace("~",SQR.shaderPath)}switch(f){case"glsl":SQR.Loader.loadText(u,i);break;case"png":case"jpg":case"gif":SQR.Loader.loadImage(u,i);break;case"json":case"js":SQR.Loader.loadJSON(u,i);break;case"mp4":case"webm":SQR.Loader.loadVideo(u,i);break;case"webcam":SQR.Loader.loadWebcam(i)}}}},SQR.Renderer=function(e){var r,t,n={},a=[],i=[],o=function(e){if(e.active){if(e.transformWorld(),e.numChildren>0)for(var r=0;r<e.numChildren;r++)o(e.children[r]);e.buffer&&e.shader&&(e.transparent?i.push(e):a.push(e))}},u={};return n.render=function(f,E,s){var l=SQR.gl;s=s||u,s.dontClear||e.clear(),l.disable(l.BLEND),l.enable(l.DEPTH_TEST),l.enable(l.CULL_FACE),l.frontFace(l.CW),a.length=0,i.length=0,o(f),E&&E.computeInverseMatrix(),a=a.concat(i);var c,R=a.length,d=null,T=null,m=!1,_=s&&s.replacementShader;_&&(T=s.replacementShader.use());for(var S=0;R>S;S++){r=!1,t=!1;var c=a[S];if(c.transformView(E?E.inverseWorldMatrix:null),c.transparent&&(m||(l.enable(l.BLEND),m=!0),l.blendFunc(c.srcFactor,c.dstFactor)),d!=c.buffer&&(d=c.buffer,d.bind(),t=!0),T!=c.shader&&!_){T=c.shader.use().updateTextures();var A=E&&E.projection||n.projection;A&&T.setUniform("uProjection",A),r=!0}(r||t)&&T.attribPointers(d),c.draw(s)}},n.renderToScreen=function(){var e=SQR.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},n},SQR.Shader=function(e,r){var t,n={},a={},i=[],o={},u=[],f=[],E=function(e){if(!e)throw"> SQR.Shader.parseGLSL - Shader source code missing";var t="",n=r?r.directives:null;if(n&&n instanceof Array)for(var a=0;a<n.length;a++)t+="#define "+n[a].name,n[a].value&&(t+=" "+n[a].value),t+="\n";for(var i=t,o=t,u=!0,f=e.split("\n"),a=0;a<f.length;a++){var E=f[a];if(E.indexOf("//#include")>-1){var s,l=E.substring(11);if(s=SQR.GLSL&&SQR.GLSL[l.substring(1)]?SQR.GLSL[l.substring(1)]:SQR.Loader.assets[l.replace("~",SQR.shaderPath)],!s)throw"> SQR.Shader.parseGLSL - Include not found "+l;f[a]=s}}for(var f=f.join("\n").split("\n"),a=0;a<f.length;a++){var E=f[a];if(E.indexOf("//#")>-1)E.indexOf("//#fragment")>-1?u=!1:E.indexOf("//#vertex")>-1&&(u=!0);else{if(E.indexOf("//")>-1&&(E=E.substring(0,E.indexOf("//"))),E.match(/^([\s\t]*)$/))continue;u?i+=E+"\n":o+=E+"\n"}}return{vertex:i,fragment:o}};n.compile=function(){var r=e=E(e),a=SQR.gl,i=a.createShader(a.VERTEX_SHADER);a.shaderSource(i,r.vertex),a.compileShader(i);var o=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(o,r.fragment),a.compileShader(o),t=a.createProgram(),a.attachShader(t,i),a.attachShader(t,o),a.linkProgram(t),!a.getShaderParameter(i,a.COMPILE_STATUS))throw"> SQR.Shader. Vertex shader compile error: "+a.getShaderInfoLog(i);if(!a.getShaderParameter(o,a.COMPILE_STATUS))throw"> SQR.Shader. Fragment shader compile error: "+a.getShaderInfoLog(o);if(!a.getProgramParameter(t,a.LINK_STATUS))throw"> SQR.Shader. Shader linking error: "+a.getProgramInfoLog(t);return n},n.inspect=function(){for(var e=SQR.gl,r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),E=0;r>E;E++){var s=e.getActiveAttrib(t,E);s.location=e.getAttribLocation(t,s.name),a[s.name]=s,i.push(s)}for(var l=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),c=0,E=0;l>E;E++){var R=e.getActiveUniform(t,E);R.location=e.getUniformLocation(t,R.name),(R.type==e.SAMPLER_2D||R.type==e.SAMPLER_CUBE)&&(R.texId=c++,f.push(R)),o[R.name]=R,u.push(R)}return n};var s="string";n.getUniform=function(e){return o[e]},n.hasUniform=function(e){return null!=o[e]},n.setUniform=function(e,r){var t=SQR.gl,a=typeof e==s?o[e]:e,i=r;if(!a)return SQR.WARN_UNIFORM_NOT_PRESENT&&(console.warn("> SQR.Shader attempt to set uniform that does not exist: "+e),console.trace()),n;switch(i.toUniform&&(i=i.toUniform(a.type)),a.type){case t.BYTE:t.uniform1i(a.location,i);break;case t.UNSIGNED_BYTE:t.uniform1i(a.location,i);break;case t.SHORT:t.uniform1i(a.location,i);break;case t.UNSIGNED_SHORT:t.uniform1i(a.location,i);break;case t.INT:t.uniform1i(a.location,i);break;case t.INT_VEC2:t.uniform2iv(a.location,i);break;case t.INT_VEC3:t.uniform3iv(a.location,i);break;case t.INT_VEC4:t.uniform4iv(a.location,i);break;case t.UNSIGNED_INT:t.uniform1i(a.location,i);break;case t.FLOAT:t.uniform1f(a.location,i);break;case t.FLOAT_VEC2:t.uniform2fv(a.location,i);break;case t.FLOAT_VEC3:t.uniform3fv(a.location,i);break;case t.FLOAT_VEC4:t.uniform4fv(a.location,i);break;case t.BOOL:t.uniform1i(a.location,i);break;case t.BOOL_VEC2:t.uniform2iv(a.location,i);break;case t.BOOL_VEC3:t.uniform3iv(a.location,i);break;case t.BOOL_VEC4:t.uniform4iv(a.location,i);break;case t.FLOAT_MAT2:t.uniformMatrix2fv(a.location,!1,i.data||i);break;case t.FLOAT_MAT3:t.uniformMatrix3fv(a.location,!1,i.data||i);break;case t.FLOAT_MAT4:t.uniformMatrix4fv(a.location,!1,i.data||i);break;case t.SAMPLER_2D:l(a,i);break;case t.SAMPLER_CUBE:c(a,i);break;default:console.warn("> SQR.Shader > WARNING! Unknown uniform type ( 0x"+a.type.toString(16)+" )")}return n};var l=function(e,r){var t=SQR.gl,n=e.texId;e.texref=r,t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,r.tex||r),r.isAnimated&&r.update(),t.uniform1i(e.location,n)},c=function(e,r){var t=SQR.gl,n=e.texId;e.texref=r,t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_CUBE_MAP,r.tex||r),t.uniform1i(e.location,n)};return n.updateTextures=function(){for(var e=(SQR.gl,0),r=f.length;r>e;e++){var t=f[e];t.texref&&n.setUniform(t,t.texref)}return n},n.use=function(){return SQR.gl.useProgram(t),n},n.attribPointers=function(e){var r=SQR.gl,t=i.length;e=e.buffer||e;for(var a=0;t>a;a++){var o=i[a],u=e.attributes[o.name];if(!u)throw"> SQR.Shader expects attribute "+o.name+" but geometry doesn't provide it";o.enabled||r.enableVertexAttribArray(o.location),r.vertexAttribPointer(o.location,u.size,r.FLOAT,!1,e.strideByteSize,u.byteOffset),o.enabled=!0}return n},r&&r.doNotCompile||(n.compile(),n.inspect()),n},SQR.Texture=function(e,r){if(r=r||{},!(e instanceof HTMLVideoElement||e instanceof Image||e instanceof HTMLCanvasElement))throw console.error("Invalid source: "+e),"SQR.Texture > provided source is not a valid source for texture";var t={},n=SQR.gl,a=e,i=n.createTexture();t.isAnimated=r&&r.isAnimated||e instanceof HTMLVideoElement;var o=function(){var e=a.width,r=a.height;return e>0&&r>0&&0==(e&e-1)&&0==(r&r-1)};t.update=function(){var e=SQR.gl;return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),t};var u=r.wrapS||r.wrap||n.CLAMP_TO_EDGE,f=r.wrapT||r.wrap||n.CLAMP_TO_EDGE;n.bindTexture(n.TEXTURE_2D,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,a);var E,s;return o()?(n.generateMipmap(n.TEXTURE_2D),E=n.LINEAR_MIPMAP_LINEAR,s=n.LINEAR):E=s=n.LINEAR,n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,E),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,u),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,f),n.bindTexture(n.TEXTURE_2D,null),t.tex=i,t},SQR.Transform=function(e){var r={},t=0;return r.name=e||"sqr.transform."+SQR.TransformCount++,r.active=!0,r.directMatrixMode=!1,r.matrix=new SQR.Matrix44,r.position=new SQR.V3,r.globalPosition=new SQR.V3,r.quaternion=new SQR.Quaternion,r.rotation=new SQR.V3,r.scale=new SQR.V3(1,1,1),r.useQuaternion=!1,r.isStatic=!1,r.normalMatrix=new SQR.Matrix33,r.globalMatrix=new SQR.Matrix44,r.viewMatrix=new SQR.Matrix44,r.inverseWorldMatrix,r.lookAt=null,r.transparent=!1,r.srcFactor=null,r.dstFactor=null,r.setBlending=function(e,t,n){r.transparent=e,r.srcFactor=t||SQR.gl.SRC_ALPHA,r.dstFactor=n||SQR.gl.ONE_MINUS_SRC_ALPHA},r.children=[],r.numChildren=0,r.add=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t.parent=r,-1==r.children.indexOf(t)&&r.children.push(t)}return r.numChildren=r.children.length,r},r.remove=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=r.children.indexOf(t);if(-1==n)return!1;t.parent=null,r.children.splice(n,1)}return r.numChildren=r.children.length,r},r.removeAll=function(){r.children.length=0,r.numChildren=0},r.contains=function(e){return r.children.indexOf(e)>-1},r.recurse=function(e,t){t||e(r);for(var n=0;n<r.numChildren;n++)r.children[n].recurse(e)},r.draw=function(e){var t=e&&e.replacementShader,n=t?e.replacementShader:r.shader;if(n.setUniform("uMatrix",r.globalMatrix),n.setUniform("uViewMatrix",r.viewMatrix),n.setUniform("uNormalMatrix",r.normalMatrix),!t&&n.uniforms)for(var a=Object.keys(n.uniforms),i=0,o=a.length;o>i;i++)n.setUniform(a[i],n.uniforms[a[i]]);if(!t&&r.uniforms)for(var a=Object.keys(r.uniforms),i=0,o=a.length;o>i;i++)n.setUniform(a[i],r.uniforms[a[i]]);r.buffer.draw()},r.transformWorld=function(){if(1!=t){if(!r.directMatrixMode){var e=r.position,n=r.scale;if(r.useQuaternion){var a=r.quaternion;r.matrix.setTQS(e.x,e.y,e.z,a.w,a.x,a.y,a.z,n.x,n.y,n.z)}else{var i=r.rotation;r.matrix.setTRS(e.x,e.y,e.z,i.x,i.y,i.z,n.x,n.y,n.z)}}r.lookAt&&r.matrix.lookAt(r.lookAt.position),r.parent?(r.parent.globalMatrix.copyTo(r.globalMatrix),r.globalMatrix.multiply(r.matrix)):r.matrix.copyTo(r.globalMatrix),r.globalMatrix.extractPosition(r.globalPosition),r.isStatic&&(t=1)}},r.viewDepth=function(){return r.viewMatrix.data[14]},r.transformView=function(e){e?(e.copyTo(r.viewMatrix),r.viewMatrix.multiply(r.globalMatrix),r.viewMatrix.inverseMat3(r.normalMatrix)):(r.globalMatrix.copyTo(r.viewMatrix),r.viewMatrix.inverseMat3(r.normalMatrix))},r.computeInverseMatrix=function(){return r.inverseWorldMatrix||(r.inverseWorldMatrix=new SQR.Matrix44),r.globalMatrix.inverse(r.inverseWorldMatrix),r.inverseWorldMatrix},r},SQR.TransformCount=0;